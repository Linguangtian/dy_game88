<?php
 goto iCjNT; iCjNT: defined('IN_IA') or exit('Access Denied'); goto HYA4B; HYA4B: require_once IA_ROOT . '/addons/junsion_winaward/func.php'; goto nuOGq; BOKot: define('OD_ROOT', IA_ROOT . '/addons/junsion_winaward/cert/'); goto ZTLku; nuOGq: define('RES', '../addons/junsion_winaward/public/'); goto BOKot; ZTLku: class junsion_winawardModuleSite extends WeModuleSite { public function getMem($shareid = 0) { goto X7LRl; fWgkq: o78hK: goto cNBWc; BGCT_: $mem = get('select * from ' . tb('mem') . " where openid='{$openid}' and weid='{$_W['uniacid']}'"); goto D41lA; ctWmi: $m = mc_fetch($fans['uid'], array("avatar")); goto GEfGe; QTLAt: $this->doInvite($shareid); goto l3Pa6; KtD5E: goto o78hK; goto NyojU; IhXfp: if (empty($fans['nickname'])) { goto s5Dsq; } goto ctWmi; Mn_JU: snw4A: goto fL9tu; x1kdO: $mem['id'] = pdo_insertid(); goto iRG3V; M2ow8: if (!(empty($mem['avatar']) && $fans['avatar'])) { goto UdVBz; } goto rV0kE; a1Jmq: return $mem; goto ITIxY; rGZ8q: if (!empty($openid)) { goto cKdz4; } goto RlmK1; rV0kE: update('mem', array("avatar" => $fans['avatar']), array("id" => $mem['id'])); goto MxAnA; lIfsk: $fans = mc_oauth_userinfo(); goto fWgkq; NyojU: s5Dsq: goto lIfsk; D41lA: if (empty($mem)) { goto snw4A; } goto M2ow8; MxAnA: UdVBz: goto z_Ryt; RlmK1: $openid = $_GPC['openid']; goto h1Xzu; nt8iK: insert('mem', $mem); goto x1kdO; X7LRl: global $_W, $_GPC; goto BDWVZ; l3Pa6: sA7UB: goto k6iLg; rtqaL: $fans = $_W['fans']; goto IhXfp; iRG3V: if (empty($shareid)) { goto sA7UB; } goto QTLAt; fL9tu: $mem = array("weid" => $_W['uniacid'], "openid" => $_W['openid'], "nickname" => $fans['nickname'], "avatar" => $fans['avatar'], "agentid" => $shareid, "credit" => 0, "createtime" => time()); goto nt8iK; z_Ryt: goto fQ710; goto Mn_JU; k6iLg: fQ710: goto ofZvK; h1Xzu: cKdz4: goto BGCT_; BDWVZ: load()->model('mc'); goto rtqaL; GEfGe: $fans['avatar'] = $m['avatar']; goto KtD5E; cNBWc: $openid = $_W['openid']; goto rGZ8q; ofZvK: $mem['avatar'] = str_replace('132132', '132', $mem['avatar']); goto a1Jmq; ITIxY: } public function doInvite($mid, $cfg = "") { goto g2sAn; IM9ri: updateMemCredit($params); goto qrvY5; FoXSo: insert('invite_log', $log); goto e4TcG; qCsRa: insert('invite_log', $log); goto NFUN5; YXIBz: $ret = pdo_query($inert_sql); goto LnEoA; KrAqo: $inert_sql .= ' VALUES ' . $insert_val; goto YXIBz; vMgei: kQlGs: goto RJP88; XRi4T: goto GI2aG; goto YQK7m; I09PA: $insert_val .= " ( '{$_W['uniacid']}','{$mid}','{$orderno}','{$gid}','{$status}','{$remark}','{$time}' ) "; goto K3fj9; XRqNo: if (!($inviteMem > $todayMem)) { goto pBE27; } goto z76Id; SMJIm: lTf8t: goto I09PA; R9Nzv: GI2aG: goto PGUgd; PGUgd: if (!($i < $cfg['invite']['num'])) { goto lxZHQ; } goto nQz0g; tVCUz: $inviteLog = col('select count(1) from ' . tb('invite_log') . " where mid='{$mid}' and to_days(from_unixtime(createtime)) = to_days(now()) "); goto UI4jZ; BI_Bp: return 0; goto OeIwG; nQz0g: $time = $time + i; goto d01vy; z76Id: return 0; goto UozOP; OeIwG: ThtFq: goto z0kg5; iRPrX: if (empty($insert_val)) { goto lTf8t; } goto S4Ed0; qrvY5: $log = array("weid" => $_W['uniacid'], "mid" => $mid, "credit" => $cfg['invite']['num'], "remark" => "赠送记录", "createtime" => time()); goto FoXSo; fVy0H: $time = time(); goto w6SKY; VdAWL: $params = array("mid" => $mid, "credit" => $cfg['invite']['num'], "remark" => "邀请赠送"); goto IM9ri; RRnlY: if (empty($insert_val)) { goto zbHEf; } goto KrAqo; B7urn: $i++; goto XRi4T; UI4jZ: if (!($inviteLog >= $cfg['invite']['limit'] && $cfg['invite']['limit'] > 0)) { goto ThtFq; } goto BI_Bp; S4Ed0: $insert_val .= ', '; goto SMJIm; LnEoA: zbHEf: goto ctYvM; g2sAn: global $_W; goto qAB07; NFUN5: return 1; goto bcbBQ; p2EEV: $remark = '邀请赠送'; goto XH6Lc; pBB3X: $inviteMem = ($inviteLog + 1) * $cfg['invite']['mem']; goto XRqNo; cBcif: $insert_val = ''; goto fVy0H; K3fj9: VFKI0: goto B7urn; gTDRR: return 0; goto gQLb5; ctYvM: $log = array("weid" => $_W['uniacid'], "mid" => $mid, "gid" => $gid, "remark" => "赠送记录", "createtime" => time()); goto qCsRa; O2R2j: if (empty($cfg['invite']['mem'])) { goto ZUx1P; } goto pBB3X; e4TcG: return 1; goto lri47; GNduG: $i = 0; goto R9Nzv; w6SKY: $status = 1; goto p2EEV; dmn3x: $cfg = $this->module['config']; goto dv5mZ; d01vy: $orderno = 'J' . $_W['uniacid'] . strtoupper(random(8)) . $time; goto iRPrX; gQLb5: A566a: goto tVCUz; AJm4V: return 0; goto vMgei; V0B1a: ZUx1P: goto VdAWL; qAB07: if (!empty($cfg)) { goto c_64z; } goto dmn3x; RJP88: $isInvite = 1; goto O2R2j; N85Jg: if (!empty($todayMem)) { goto kQlGs; } goto AJm4V; lri47: $inert_sql = 'INSERT INTO ' . tablename('junsion_winaward_order') . ' (weid,mid,orderno,gid,status,remark,createtime) '; goto cBcif; XH6Lc: $gid = $cfg['invite']['gid']; goto GNduG; dv5mZ: c_64z: goto hlfH6; UozOP: pBE27: goto V0B1a; hlfH6: if (!(empty($cfg['invite']['status']) || empty($cfg['invite']['num']))) { goto A566a; } goto gTDRR; z0kg5: $todayMem = col('select count(1) from ' . tb('mem') . " where weid='{$_W['uniacid']}' and agentid = '{$mid}' and avatar != '' and to_days(from_unixtime(createtime)) = to_days(now()) "); goto N85Jg; YQK7m: lxZHQ: goto RRnlY; bcbBQ: } public function getShare($openid, $cfg = "") { goto c0O2R; Go1uL: $share['pic'] = toimage($cfg['commission']['pic']); goto pHbQJ; IuEAZ: $cfg = $this->module['config']; goto mn1Sr; L6Y4D: Gn8aZ: goto rLLGv; tU8Rm: $share['title'] = str_replace('#nickname#', $mem['nickname'], $share['title']); goto ZJnRM; zxdB2: if (!empty($cfg)) { goto kUSnc; } goto IuEAZ; c0O2R: global $_W; goto zxdB2; dVEx1: if (empty($share['pic'])) { goto Gn8aZ; } goto xR448; xR448: $share['pic'] = toimage($share['pic']); goto L6Y4D; xgrLh: if (!empty($mem) && !empty($cfg['commission']['status'])) { goto arLkW; } goto xdA7G; lmXoN: VNNUI: goto oPUUW; pHbQJ: xJFaf: goto lmXoN; n5TS8: return $share; goto s3hfq; bPNZ0: if (empty($cfg['commission']['pic'])) { goto xJFaf; } goto Go1uL; xdA7G: $url = $_W['siteroot'] . 'app' . substr($this->createMobileUrl('index'), 1); goto dVEx1; LL3bF: $share['title'] = $cfg['commission']['title']; goto tU8Rm; ZJnRM: $share['des'] = $cfg['commission']['des']; goto bPNZ0; x52hZ: $url = $_W['siteroot'] . 'app' . substr($this->createMobileUrl('index', array("shareid" => $mem['id'])), 1); goto LL3bF; oPUUW: $share['url'] = $url; goto n5TS8; r6L4i: $mem = get('select id,nickname from ' . tb('mem') . " where openid='{$openid}' and weid='{$_W['uniacid']}'"); goto F19pp; rLLGv: goto VNNUI; goto NRYFv; mn1Sr: kUSnc: goto r6L4i; NRYFv: arLkW: goto x52hZ; F19pp: $share = $cfg['share']; goto xgrLh; s3hfq: } public function doMobileGame() { goto BCX0i; D7h1d: $gGame = unserialize($good['game']); goto kRt1v; S56So: D1jDS: goto tKtB5; CaGBj: if (!($cfg['limit']['hard'] > 0)) { goto e0I56; } goto udoCw; w5u1V: $gGame[0]['time'] = $gGame[0]['time'] + 2; goto o1cPd; pFuNU: foreach ($game as $k => $v) { goto pM00q; A3ecL: ggq78: goto iReir; SxIqy: vWqjJ: goto R9FBY; pM00q: if (is_array($v)) { goto te1ay; } goto GlppZ; GlppZ: $game[$k] = tomedia($v); goto edDhA; iReir: $game[$k] = $v; goto HKsYd; HKsYd: Mp60g: goto SxIqy; pboRE: foreach ($v as $kk => $vv) { $v[$kk] = tomedia($vv); KB04M: } goto A3ecL; U4Tlj: te1ay: goto pboRE; edDhA: goto Mp60g; goto U4Tlj; R9FBY: } goto JRyXd; tVwf1: $mid = $_GPC['mid']; goto gLmBv; kAmgC: e0I56: goto S3Lvd; W24KM: include $this->mytemplate('game'); goto Pi8kb; Fxqfn: $oid = $_GPC['oid']; goto tVwf1; Qzge7: $gGame[2]['hard'] = 5; goto XXOw0; Ssy2F: $hard = array(array(-0.04, -0.02, -0.01, 0.01, 0.03, 0.05, 0.05), array(-0.06, -0.04, -0.02, 0.01, 0.03, 0.07000000000000001, 0.07000000000000001), array(-0.08, -0.06, -0.04, 0.03, 0.05, 0.07000000000000001, 0.09), array(-0.1, -0.08, -0.06, 0.05, 0.07000000000000001, 0.09, 0.1), array(-0.1, -0.12, -0.14, 0.11, 0.13, 0.15, 0.17)); goto CaGBj; SBYaw: $mem = get('select id,status from ' . tb('mem') . " where id='{$mid}' and status=0"); goto le536; GbtvH: if (!($award >= $cfg['limit']['hard'])) { goto O_DmD; } goto Qzge7; le536: $good = get('select id,status,game,buy from ' . tb('good') . " where id='{$order['gid']}' and status=1"); goto f9PMT; XXOw0: O_DmD: goto kAmgC; f9PMT: $cfg = $this->module['config']; goto D7h1d; S3Lvd: foreach ($gGame as &$gg) { $gg['speed_arr'] = $hard[$gg['hard'] - 1]; OTT0G: } goto ZXa0n; tKtB5: $gGame = array(array("num" => 6, "hard" => 1, "time" => 30), array("num" => 10, "hard" => 1, "time" => 40), array("num" => 13, "hard" => 3, "time" => 50)); goto MZEw5; R0QqW: $game = $cfg['game']; goto pFuNU; kRt1v: if (empty($order) || empty($mem) || empty($good)) { goto D1jDS; } goto w5u1V; MZEw5: MHIVv: goto Ssy2F; BCX0i: global $_W, $_GPC; goto Fxqfn; udoCw: $award = col('select count(1) from ' . tb('log') . " where mid='{$mid}' and status=1"); goto GbtvH; JRyXd: EgZ_o: goto W24KM; o1cPd: goto MHIVv; goto S56So; ZXa0n: n8cUQ: goto R0QqW; gLmBv: $order = get('select id,gid from ' . tb('order') . " where id='{$oid}' and status=1"); goto SBYaw; Pi8kb: } public function mytemplate($filename) { goto z2V8K; Z_ycu: $compile = str_replace($paths['filename'], $_W['uniacid'] . '_' . intval($_GPC['t']) . '_' . $paths['filename'], $compile); goto nkznf; jKuzG: $paths = pathinfo($compile); goto Z_ycu; TQ6TH: extract($GLOBALS, EXTR_SKIP); goto B7ojp; tTM0W: template_compile($source, $compile); goto A0KkR; BnHtA: $compatFilename = template_compat($filename); goto m1jH9; z7824: $source = IA_ROOT . "/addons/junsion_winaward/template/{$filename}.html"; goto aFO6I; aFO6I: $compile = IA_ROOT . "/data/tpl/app/default/junsion_winaward/{$filename}.tpl.php"; goto yqRzy; sVf8a: qCZdq: goto UBN55; m1jH9: if (empty($compatFilename)) { goto vHXaZ; } goto ItGWY; z2V8K: global $_W, $_GPC; goto z7824; UBN55: if (is_file($source)) { goto q_QPG; } goto Inj_u; xLgO2: q_QPG: goto jKuzG; nkznf: if (!(DEVELOPMENT || !is_file($compile) || filemtime($source) > filemtime($compile))) { goto dvd8W; } goto tTM0W; ItGWY: return $this->mytemplate($compatFilename, $flag); goto VkcHd; B7ojp: return $compile; goto gdbml; A0KkR: dvd8W: goto TQ6TH; VkcHd: vHXaZ: goto sVf8a; Inj_u: exit("Error: template source '{$filename}' is not exist!"); goto xLgO2; yqRzy: if (is_file($source)) { goto qCZdq; } goto BnHtA; gdbml: } public function doMobileCheckRes() { goto aUvCK; oM6hH: if (!empty($log)) { goto sdnTT; } goto mcIq9; fr8lg: $order = get('select id,gid from ' . tb('order'), " where id='{$oid}' and status=1"); goto tJPjc; LTSQ1: goto FvRSe; goto ySOg_; ySOg_: LyJq0: goto nMzb1; sgiUR: $arr = array("code" => 1, "msg" => "更改订单状态"); goto kGsom; t7LCR: die(json_encode($arr)); goto libRJ; X5H69: update('log', array("status" => 1), array("id" => $logId)); goto Nj27n; IXRS8: insert('log', $data); goto RgfHO; u4M3j: die(json_encode($arr)); goto uVaK9; xYXVe: FSMiy: goto yiji0; G8DGp: if ($newid > 0) { goto jNIMo; } goto V7aHf; Esrdc: GcCJn: goto mGvdd; dKcDo: lx_RU: goto fr8lg; XN1eK: if ($op == 'suc') { goto GcCJn; } goto fhKDk; Nj27n: update('order', array("status" => 2), array("id" => $oid)); goto zx1rc; ZPISH: die(json_encode($arr)); goto L0PFa; FHLZS: goto obDIw; goto bWLwz; Ajeh9: FvRSe: goto kw131; rT0rh: if (!empty($mem)) { goto mTSPO; } goto eD2YP; mGvdd: $logId = $_GPC['logId']; goto m237Q; KHsra: die(json_encode($arr)); goto xYXVe; XQWuZ: $arr = array("code" => 0, "msg" => "该订单已经参与过闯关，无法重复参与"); goto pu2s4; fhKDk: if ($op == 'fail') { goto sJMqr; } goto LTSQ1; dGe5R: $data = array("weid" => $_W['uniacid'], "oid" => $oid, "mid" => $mid, "gid" => $order['gid'], "createtime" => time()); goto IXRS8; aUvCK: global $_W, $_GPC; goto uLrr1; sIsiq: $op = $_GPC['op']; goto gixCn; mcIq9: $arr = array("code" => 0, "msg" => "参与记录不存在"); goto u4M3j; V7aHf: $arr = array("code" => 0, "msg" => "创建参与记录错误"); goto tWY1l; kGsom: die(json_encode($arr)); goto Ajeh9; L0PFa: mTSPO: goto dGe5R; gixCn: if (empty($op)) { goto LyJq0; } goto XN1eK; I7ixY: obDIw: goto ocBmS; libRJ: goto FvRSe; goto EM768; BoFyT: die(json_encode($arr)); goto I7ixY; tJPjc: if (!empty($order)) { goto FSMiy; } goto Kx_uv; nMzb1: $log = get('select id from ' . tb('log') . " where mid='{$mid}' and oid='{$oid}'"); goto eJVqZ; zx1rc: $arr = array("code" => 1, "msg" => "闯关成功"); goto t7LCR; uLrr1: $oid = $_GPC['oid']; goto tOEdr; bWLwz: jNIMo: goto zmj2J; er9KU: update('order', array("status" => -1, "remark" => $remark), array("id" => $oid)); goto sgiUR; RgfHO: $newid = pdo_insertid(); goto G8DGp; eD2YP: $arr = array("code" => 0, "msg" => "本活动仅限会员参与"); goto ZPISH; ocBmS: goto FvRSe; goto Esrdc; tWY1l: die(json_encode($arr)); goto FHLZS; X6qR5: $remark = '关卡：第' . $_GPC['level'] . '关，失败'; goto er9KU; pu2s4: die(json_encode($arr)); goto dKcDo; yiji0: $mem = get('select id from ' . tb('mem') . " where id='{$mid}' and status=0"); goto rT0rh; Kx_uv: $arr = array("code" => 0, "msg" => "订单不存在或状态错误"); goto KHsra; eJVqZ: if (empty($log)) { goto lx_RU; } goto XQWuZ; EM768: sJMqr: goto X6qR5; zmj2J: $arr = array("code" => 1, "logid" => $newid, "msg" => "创建参与记录成功"); goto BoFyT; uVaK9: sdnTT: goto X5H69; tOEdr: $mid = $_GPC['mid']; goto sIsiq; m237Q: $log = get('select id,status from ' . tb('log') . " where id='{$logId}' and mid='{$mid}' and oid='{$oid}'"); goto oM6hH; kw131: } public function commissionMoney($order, $cfg = "") { goto Qy2DT; XQj2L: if (empty($levelCommission3['redRate3'])) { goto R5Cg9; } goto OIG7d; scs9L: update('recharge', array("commission3" => $credit3, "commission_red3" => $red3), array("id" => $order['id'])); goto HWkCl; QXugD: if (!(empty($cfg['commission']['num2']) || $creditNum2 < $cfg['commission']['num2'])) { goto QMNES; } goto UGuuF; KQ0Ew: $cfg['commission']['rate3'] = $cfg['agent']['rate3']; goto eXuhr; gau3y: update('recharge', array("commission2" => $credit2, "commission_red2" => $red2), array("id" => $order['id'])); goto lO3KL; XTGC1: WB_p7: goto DyDAw; Wdp_8: $red3 = $cfg['commission']['redMoney3']; goto H_nty; ShRzS: if (empty($cfg['agent']['rate3'])) { goto oP3Zo; } goto KQ0Ew; eZ9zG: WiWhU: goto NRa8J; bDdpT: if (!(empty($cfg['commission']['status']) && !empty($cfg['islevel']) && (!empty($levelCommission['rate']) || !empty($levelCommission['money']) || !empty($levelCommission['redRate']) || !empty($levelCommission['redMoney'])))) { goto RQJdv; } goto LmvW4; agzFE: $agentid2 = get('select id,agentid,isagent,lid from ' . tb('mem') . " where id='{$agent['agentid']}'"); goto VmJbg; cle6R: if (empty($cfg['agent']['redrate2'])) { goto vX_ps; } goto UoThi; CkkVI: $cfg['commission']['redrate2'] = $levelCommission2['redrate2']; goto YS9Vj; kPt_L: u1P3l: goto enh51; Cgi1l: BccZ3: goto XTGC1; rPNYB: t5C1k: goto bGOwj; lweLV: $red3 = intval($red3 * 100) / 100; goto pR9xg; U6b_p: $cfg['commission']['rate2'] = $levelCommission2['rate2']; goto wAPMh; g21ej: $cfg['commission']['redMoney2'] = $levelCommission2['redMoney2']; goto Ro0xu; FzKwN: $credit3 = $cfg['commission']['money3']; goto AD0qS; f44_s: goto tmvtI; goto JIkMo; enh51: OFXHn: goto sLT8_; y5a0j: $levelCommission3 = unserialize($agentMemLevel3['commission']); goto Ws8fl; uSpbo: if (!(empty($cfg['commission']['redNum2']) || $redNum2 < $cfg['commission']['redNum2'])) { goto RQk4X; } goto jfHP7; MXIMS: $credit3 = intval($credit3 * 100) / 100; goto hizcL; fNMsi: zv_OF: goto MygQm; Er3aF: $redNum2 = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and commission_red2 > 0 and weid='{$_W['uniacid']}' and status = 1"); goto uSpbo; Ro0xu: C1Vo4: goto WAgZn; s6Uyf: if (empty($agent['agentid'])) { goto FSwYA; } goto agzFE; c2NZB: if ($cfg['commission']['redRate'] > 0) { goto JhBDi; } goto lf280; wJI1U: rDbwt: goto LAzeG; LmvW4: $cfg['commission']['status'] == 1; goto VDcfu; vyB9o: tolOa: goto m808V; xf9oB: $redNum = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and commission_red > 0 and weid='{$_W['uniacid']}' and status = 1"); goto u52Nx; pR9xg: ESpbh: goto r6Atf; rCyy0: $cfg['commission']['status'] == 2; goto IXUt1; EpFXg: if (!($cfg['commission']['status'] >= 2 || $agentid2['isagent'] == 1)) { goto YgOuJ; } goto QXugD; T5bZe: $red = $order['price'] * $cfg['commission']['redRate'] / 100; goto Uwd_R; F4yKr: return 0; goto Ow4F0; r6Atf: if (!($red3 > 0)) { goto HqIQ5; } goto Slnac; JIkMo: JhBDi: goto T5bZe; y8Cuh: RQk4X: goto SeiEA; QEorP: $cfg['commission']['rate'] = $levelCommission['rate']; goto JeBL5; UoThi: $cfg['commission']['redRate2'] = $cfg['agent']['redrate2']; goto MN137; Pjm2b: NZJfB: goto AuUF_; q6KT3: $agentid3 = get('select id,agentid,isagent,lid from ' . tb('mem') . " where id='{$agentid2['agentid']}'"); goto rQ8a7; Hw8GG: $cfg['commission']['rate3'] = $levelCommission3['rate3']; goto wRcHS; o6NX2: $levelCommission2 = unserialize($agentMemLevel2['commission']); goto hbkXW; gEJKC: if (empty($cfg['agent']['redrate1'])) { goto Jzvho; } goto CqpPy; h68ny: Qhyfd: goto Iw5gN; AuUF_: if (empty($levelCommission2['redMoney2'])) { goto C1Vo4; } goto g21ej; k0IqH: if ($cfg['commission']['rate3'] > 0) { goto Wufno; } goto FzKwN; ZJdOk: if (!($cfg['commission']['redRate3'] > 0 || $cfg['commission']['redMoney3'] > 0)) { goto G8lcG; } goto Djkwp; mRIrz: QMNES: goto Er3aF; qOtWB: lQ7fb: goto qO1eg; YS9Vj: oQ_qq: goto Y3wi_; FT8JT: HqIQ5: goto YlPpg; WbZOs: XO2ZG: goto PM78j; WtUSb: return 0; goto ZFWC4; lgasI: Z13hi: goto mRIrz; d6QM1: if (!($cfg['commission']['status'] >= 3 || $agentid3['isagent'] == 1)) { goto kedX8; } goto te_UZ; kPHoU: FSwYA: goto UO8X2; LAzeG: if (!($credit > 0 || $red > 0)) { goto S_0bJ; } goto ZoeDP; YlPpg: G8lcG: goto cYumJ; cYumJ: zXx9I: goto AWxlg; QIVXf: lv2pr: goto nusUK; zUhYg: if (!(!empty($cfg['islevel']) && !empty($agent['lid']))) { goto LFEYO; } goto rokBw; tgGG_: updateMemRed(array("mid" => $agentid2['id'], "aid" => $order['mid'], "credit" => $red2, "remark" => "二级佣金")); goto dDhdC; MXGnX: goto t5C1k; goto tL10Q; eZhpS: k0IGl: goto XQj2L; Iw5gN: if (!($cfg['commission']['status'] >= 1 || $agent['isagent'] == 1)) { goto A0hkn; } goto Xrtjs; Y3coH: OYHzg: goto vd3LV; ZFWC4: AcWXT: goto kigYl; H_nty: goto ESpbh; goto oUbZq; utNju: R5Cg9: goto oC9AL; Ql79p: $cfg['commission']['money3'] = $levelCommission3['money3']; goto eZhpS; Djkwp: if ($cfg['commission']['redRate3'] > 0) { goto nh9Mq; } goto Wdp_8; FWuVh: yF_uF: goto SUeao; YzMm3: YqTRJ: goto zUhYg; ZShm1: if (!($cfg['commission']['status'] >= 3 || $cfg['agent']['status'] >= 3)) { goto BccZ3; } goto jcrIV; N0SNn: return 0; goto vyB9o; rokBw: if (empty($levelCommission2['rate2'])) { goto r4oD7; } goto U6b_p; dPRd4: if (!(empty($cfg['commission']['redNum3']) || $redNum3 < $cfg['commission']['redNum3'])) { goto zXx9I; } goto ZJdOk; BBuWi: $cfg['commission']['redMoney'] = $levelCommission['redMoney']; goto kHa3N; qO1eg: if (!(!empty($cfg['islevel']) && !empty($agent['lid']))) { goto Qhyfd; } goto zP9Gt; pMVOP: if (!($red2 > 0)) { goto vIyA_; } goto tgGG_; Xpb3d: if (!($cfg['commission']['rate'] > 0 || $cfg['commission']['money'] > 0)) { goto LZ7Nv; } goto txKSF; q3wbr: Lgh5X: goto OAFlb; hbkXW: if (!($cfg['commission']['status'] < 2 && !empty($cfg['islevel']) && (!empty($levelCommission2['rate2']) || !empty($levelCommission2['money2']) || !empty($levelCommission2['redMoney2']) || !empty($levelCommission2['redrate2'])))) { goto ZhDsr; } goto rCyy0; m808V: if (!($cfg['agent']['status'] >= 2 && $agentid2['isagent'] == 1)) { goto YqTRJ; } goto TfPyW; gRhCV: $cfg['commission']['num3'] = $levelCommission3['num3']; goto qMqaE; GUTap: if (empty($levelCommission['redrate'])) { goto cq9LM; } goto yjM5_; ks4wt: if ($cfg['commission']['redRate2'] > 0) { goto zv_OF; } goto FnUH3; LyOQo: kU7uD: goto h68ny; Ku0SJ: if (empty($cfg['agent']['rate1'])) { goto Vh7EN; } goto t9kaD; slBbP: $mem = get('select id,agentid from ' . tb('mem') . " where id='{$order['mid']}'"); goto j4wWe; FnUH3: $red2 = $cfg['commission']['redMoney2']; goto Qgpmr; tfx5y: ofRRd: goto ZShm1; Kt2Fb: if (empty($levelCommission3['money3'])) { goto k0IGl; } goto Ql79p; VDcfu: RQJdv: goto chxUT; JHeKa: nIk87: goto cygpj; vd3LV: $credit = $order['price'] * $cfg['commission']['rate'] / 100; goto aPkS6; dDhdC: vIyA_: goto gQiBD; tL10Q: QDiGs: goto gy4FS; GTLwq: tmvtI: goto gnUIP; UO8X2: if (!($cfg['commission']['status'] >= 2 || $cfg['agent']['status'] >= 2)) { goto WB_p7; } goto SGmkt; HhjvG: updateMemRed(array("mid" => $agent['id'], "aid" => $order['mid'], "credit" => $red, "remark" => "一级佣金")); goto qszvg; yjM5_: $cfg['commission']['redRate'] = $levelCommission['redRate']; goto zAJNd; gwTxF: bLR3Q: goto pMVOP; MODP6: YgOuJ: goto f5hC5; f5hC5: if (empty($agentid2['agentid'])) { goto ofRRd; } goto q6KT3; G9j8B: $credit = $cfg['commission']['money']; goto lZMat; jfHP7: if (!($cfg['commission']['redRate2'] > 0 || $cfg['commission']['redMoney2'] > 0)) { goto C0jL0; } goto ks4wt; lO3KL: KiVvD: goto MODP6; OIG7d: $cfg['commission']['redRate3'] = $levelCommission3['redRate3']; goto utNju; PM78j: if (empty($levelCommission3['num3'])) { goto ZUdX5; } goto gRhCV; c8hPU: FiFvE: goto wJI1U; RrMGS: I7a5N: goto KTI5a; nusUK: if (empty($levelCommission['redNum'])) { goto kU7uD; } goto qos7E; aPkS6: $credit = intval($credit * 100) / 100; goto W8jE4; gQiBD: C0jL0: goto y8Cuh; YfFzD: $cfg['commission']['num'] = $levelCommission['num']; goto QIVXf; Y3wi_: if (empty($levelCommission2['num2'])) { goto med1X; } goto SCIW7; cHYDz: $cfg['commission']['money2'] = $levelCommission2['money2']; goto Pjm2b; W8jE4: KsIXg: goto X1Mba; HWkCl: hZRJo: goto ToyMR; qos7E: $cfg['commission']['redNum'] = $levelCommission['redNum']; goto LyOQo; GItdo: $cfg['commission']['money'] = $levelCommission['money']; goto IS7vY; zP9Gt: if (empty($levelCommission['rate'])) { goto pFqEF; } goto QEorP; o3F1f: updateMemCredit(array("mid" => $agentid2['id'], "type" => 1, "credit" => $credit2, "remark" => "二级佣金")); goto ozysW; X_0we: if (!($cfg['agent']['status'] >= 1 && $agent['isagent'] == 1)) { goto lQ7fb; } goto Ku0SJ; yh32T: $creditNum = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and commission > 0 and weid='{$_W['uniacid']}' and status = 1"); goto X_0we; J_JFH: A0hkn: goto s6Uyf; SCIW7: $cfg['commission']['num2'] = $levelCommission2['num2']; goto VjOa5; JeBL5: pFqEF: goto OujN3; X1Mba: if (!($credit > 0)) { goto nIk87; } goto rNeL0; SeiEA: if (!($credit2 > 0 || $red2 > 0)) { goto KiVvD; } goto gau3y; oUbZq: nh9Mq: goto NKtwr; cKL5n: if (!($cfg['commission']['rate3'] > 0 || $cfg['commission']['money3'] > 0)) { goto OFXHn; } goto k0IqH; lbgPO: if (!($credit3 > 0)) { goto u1P3l; } goto HGbm8; IS7vY: GWf9M: goto GUTap; AD0qS: goto D1llR; goto H1RvQ; FiwP_: if (empty($levelCommission2['redNum2'])) { goto Lgh5X; } goto dU_jy; yUh7j: $creditNum2 = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and commission2 > 0 and weid='{$_W['uniacid']}' and status = 1"); goto EpFXg; LjyKG: rKzBW: goto MCyGS; mhYzt: $red2 = intval($red2 * 100) / 100; goto gwTxF; kqkGg: Jzvho: goto qOtWB; q2Ppq: $cfg['commission']['redNum3'] = $levelCommission3['redNum3']; goto r5Tnl; kHa3N: pCvFD: goto LQfY3; Uwd_R: $red = intval($red * 100) / 100; goto GTLwq; SLRSS: return 1; goto pARIM; Wv4FA: $credit2 = intval($credit2 * 100) / 100; goto rPNYB; TfPyW: if (empty($cfg['agent']['rate2'])) { goto Yei56; } goto AE5VQ; Slnac: updateMemRed(array("mid" => $agentid2['agentid'], "aid" => $order['mid'], "credit" => $red3, "remark" => "三级佣金")); goto FT8JT; H1RvQ: Wufno: goto mFERF; rNeL0: updateMemCredit(array("mid" => $agent['id'], "type" => 1, "credit" => $credit, "remark" => "一级佣金")); goto JHeKa; q7r1K: if (empty($cfg['agent']['redrate3'])) { goto yF_uF; } goto IECQ8; te_UZ: if (!(empty($cfg['commission']['num3']) || $creditNum2 < $cfg['commission']['num3'])) { goto Hy3e4; } goto cKL5n; wAPMh: r4oD7: goto A4ADc; wRcHS: bRe85: goto Kt2Fb; NRa8J: $creditNum3 = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and commission3 > 0 and weid='{$_W['uniacid']}' and status = 1"); goto d6QM1; r5Tnl: p7E3X: goto eZ9zG; txKSF: if ($cfg['commission']['rate'] > 0) { goto OYHzg; } goto G9j8B; u52Nx: if (!(empty($cfg['commission']['redNum']) || $redNum < $cfg['commission']['redNum'])) { goto rDbwt; } goto xRAcv; rQ8a7: $agentMemLevel3 = get('select id,commission from ' . tb('level') . " where id='{$agentid3['lid']}'"); goto y5a0j; kp_qP: $cfg = $this->module['config']; goto LjyKG; dcBe8: if (empty($levelCommission3['rate3'])) { goto bRe85; } goto Hw8GG; VmJbg: $agentMemLevel2 = get('select id,commission from ' . tb('level') . " where id='{$agentid2['lid']}'"); goto o6NX2; hizcL: D1llR: goto lbgPO; dU_jy: $cfg['commission']['redNum2'] = $levelCommission2['redNum2']; goto q3wbr; gnUIP: if (!($red > 0)) { goto X2fH1; } goto HhjvG; A4ADc: if (empty($levelCommission2['money2'])) { goto NZJfB; } goto cHYDz; Exqd4: $credit2 = $cfg['commission']['money2']; goto MXGnX; Ow4F0: UzPae: goto jV9D5; WnrP_: Yei56: goto cle6R; Qy2DT: global $_W, $_GPC; goto slBbP; eXuhr: oP3Zo: goto q7r1K; LQfY3: if (empty($levelCommission['num'])) { goto lv2pr; } goto YfFzD; j4wWe: if (!empty($mem['agentid'])) { goto UzPae; } goto F4yKr; VjOa5: med1X: goto FiwP_; sLT8_: Hy3e4: goto x1bWR; R1TbI: $cfg['commission']['redMoney3'] = $levelCommission3['redMoney3']; goto WbZOs; qszvg: X2fH1: goto c8hPU; IXUt1: ZhDsr: goto kPHoU; SUeao: onKsv: goto HHGsp; chxUT: if (!($cfg['commission']['status'] >= 1 || $cfg['agent']['status'] >= 1)) { goto GKZhK; } goto yh32T; tetjQ: $levelCommission = unserialize($agentMemLevel['commission']); goto bDdpT; MN137: vX_ps: goto YzMm3; NKtwr: $red3 = $order['price'] * $cfg['commission']['redRate3'] / 100; goto lweLV; V_Ecf: KFB9S: goto xf9oB; E2IR2: S_0bJ: goto J_JFH; hNbeV: if (empty($levelCommission3['redNum3'])) { goto p7E3X; } goto q2Ppq; YFZoH: Vh7EN: goto gEJKC; UGuuF: if (!($cfg['commission']['rate2'] > 0 || $cfg['commission']['money2'] > 0)) { goto Z13hi; } goto yHdOX; HHGsp: if (!(!empty($cfg['islevel']) && !empty($agent['lid']))) { goto WiWhU; } goto dcBe8; gy4FS: $credit2 = $order['price'] * $cfg['commission']['rate2'] / 100; goto Wv4FA; yHdOX: if ($cfg['commission']['rate2'] > 0) { goto QDiGs; } goto Exqd4; x1bWR: $redNum3 = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and commission_red3 > 0 and weid='{$_W['uniacid']}' and status = 1"); goto dPRd4; KTI5a: if (!($cfg['agent']['status'] >= 3 && $agentid3['isagent'] == 1)) { goto onKsv; } goto ShRzS; qMqaE: ZUdX5: goto hNbeV; OujN3: if (empty($levelCommission['money'])) { goto GWf9M; } goto GItdo; g2ZwA: return 0; goto RrMGS; ozysW: Y89Zq: goto lgasI; bGOwj: if (!($credit2 > 0)) { goto Y89Zq; } goto o3F1f; WAgZn: if (empty($levelCommission2['redrate2'])) { goto oQ_qq; } goto CkkVI; Xrtjs: if (!(empty($cfg['commission']['num']) || $creditNum < $cfg['commission']['num'])) { goto KFB9S; } goto Xpb3d; OAFlb: LFEYO: goto yUh7j; cygpj: LZ7Nv: goto V_Ecf; ToyMR: kedX8: goto Cgi1l; ZoeDP: update('recharge', array("commission" => $credit, "commission_red" => $red), array("id" => $order['id'])); goto E2IR2; Ws8fl: if (!($cfg['commission']['status'] < 3 && !empty($cfg['islevel']) && (!empty($levelCommission3['rate3']) || !empty($levelCommission3['money3']) || !empty($levelCommission3['redMoney3']) || !empty($levelCommission3['redrate3'])))) { goto bRcuK; } goto fHm0G; DyDAw: GKZhK: goto SLRSS; lf280: $red = $cfg['commission']['redMoney']; goto f44_s; t9kaD: $cfg['commission']['rate'] = $cfg['agent']['rate1']; goto YFZoH; AWxlg: if (!($credit3 > 0 || $red3 > 0)) { goto hZRJo; } goto scs9L; jcrIV: if (!empty($agentid2['agentid'])) { goto I7a5N; } goto g2ZwA; xRAcv: if (!($cfg['commission']['redRate'] > 0 || $cfg['commission']['redMoney'] > 0)) { goto FiFvE; } goto c2NZB; kigYl: if (!empty($cfg)) { goto rKzBW; } goto kp_qP; oC9AL: if (empty($levelCommission3['redMoney3'])) { goto XO2ZG; } goto R1TbI; Qgpmr: goto bLR3Q; goto fNMsi; HGbm8: updateMemCredit(array("mid" => $agentid2['agentid'], "type" => 1, "credit" => $credit3, "remark" => "三级佣金")); goto kPt_L; tYBRy: bRcuK: goto tfx5y; zAJNd: cq9LM: goto AvQiY; lZMat: goto KsIXg; goto Y3coH; jV9D5: $agent = get('select id,agentid,isagent,lid from ' . tb('mem') . " where id='{$mem['agentid']}' and status=0"); goto JKY__; MygQm: $red2 = $order['price'] * $cfg['commission']['redRate2'] / 100; goto mhYzt; SGmkt: if (!empty($agent['agentid'])) { goto tolOa; } goto N0SNn; fHm0G: $cfg['commission']['status'] == 3; goto tYBRy; CqpPy: $cfg['commission']['redRate'] = $cfg['agent']['redrate1']; goto kqkGg; mFERF: $credit3 = $order['price'] * $cfg['commission']['rate3'] / 100; goto MXIMS; AvQiY: if (empty($levelCommission['redMoney'])) { goto pCvFD; } goto BBuWi; JKY__: if (!empty($agent)) { goto AcWXT; } goto WtUSb; MCyGS: $agentMemLevel = get('select id,commission from ' . tb('level') . " where id='{$agent['lid']}'"); goto tetjQ; IECQ8: $cfg['commission']['redRate3'] = $cfg['agent']['redrate3']; goto FWuVh; AE5VQ: $cfg['commission']['rate2'] = $cfg['agent']['rate2']; goto WnrP_; pARIM: } public function doubleRecharge($order, $cfg = "") { goto SBdl9; Ir9CF: if (!($isRecharge == 1)) { goto Td8ye; } goto EP0A7; EP0A7: updateMemCredit(array("mid" => $order['mid'], "credit" => $order['price'], "remark" => "首充双倍")); goto dY_0l; Plt9N: if (!empty($cfg)) { goto A559F; } goto dZp2F; T8dZq: if (!($is_save >= 2)) { goto obplP; } goto BBXQi; Jn67J: $isRecharge = 0; goto qs1Lx; azYbL: return 0; goto uCxiN; JWnPi: Td8ye: goto azYbL; dZp2F: $cfg = $this->module['config']; goto NIw7n; BBXQi: return 0; goto Zfms1; Rwady: return 0; goto IZCbf; OSnuM: Chrtn: goto Ir9CF; MZJ6e: $is_save = col('select count(1) from ' . tb('recharge') . " where mid='{$order['mid']}' and price='{$order['price']}' and status=1"); goto T8dZq; IZCbf: MiJHw: goto MZJ6e; SBdl9: global $_W; goto Plt9N; qzDIz: if (!empty($cfg['isdouble'])) { goto MiJHw; } goto Rwady; dY_0l: return 1; goto JWnPi; qs1Lx: foreach ($cfg['recharge'] as $k => $v) { goto lmArs; lmArs: if (!($v['money'] == $order['price'])) { goto YsAC0; } goto jqdC0; ND1gD: YsAC0: goto qjUGM; gcZrC: goto Chrtn; goto ND1gD; jqdC0: $isRecharge = 1; goto gcZrC; qjUGM: rCt1i: goto wabxM; wabxM: } goto OSnuM; NIw7n: A559F: goto qzDIz; Zfms1: obplP: goto Jn67J; uCxiN: } public function payResult($params) { goto J2OQC; kCyLc: file_put_contents(IA_ROOT . '/addons/junsion_winaward/pay', date('Y-m-d H:i:s') . ' res:' . json_encode($res) . ' order:' . json_encode($order) . '
', FILE_APPEND); goto ylHcm; fhbYH: $update_data['price'] = $params['fee']; goto DZJjE; kVy4M: if (empty($order['wx_no'])) { goto F66z5; } goto uXHy4; sg9TV: $make_appid = pdo_fetchcolumn('select `key` from ' . tablename('account_wechats') . " where uniacid = '{$_W['uniacid']}'"); goto gHKJ_; YrXQf: $make_appid = pdo_fetchcolumn('select `key` from ' . tablename('account_wechats') . " where uniacid = '{$_W['uniacid']}'"); goto iasrg; Jgqnq: if (!(empty($order) || $order['status'] > 0)) { goto l01_n; } goto wb0fW; Oc9xH: uBHDs: goto MjBbT; H_Ywn: bHk2Y: goto NDaRF; bXsyf: $res['code'] = 1; goto cqP70; BSLfX: zl9xe: goto mpvfc; zEJJE: $url = 'http://' . $_SERVER['HTTP_HOST'] . '/app' . substr($this->createMobileUrl('index'), 1); goto bRNTH; BTPiC: Jd8UK: goto bydU3; BNM38: $url = 'http://' . $_SERVER['HTTP_HOST'] . '/app' . substr($this->createMobileUrl('rouge'), 1); goto pOPE2; SzaBg: $order = get('select * from ' . tb('recharge') . " where orderno = '{$params['tid']}'"); goto VmhbO; WIxsG: $update_data = array("status" => 1, "transid" => $params['tag']['transaction_id']); goto xvhYa; YyfGK: if ($params['type'] == 'wechat') { goto LbnXW; } goto WmLHz; NMIUQ: $params['from'] = 'return'; goto h94NM; Lc3ip: sD9eR: goto b1BPj; MJaNL: dplh4: goto nFAj6; iUW9g: if (!($params['type'] == 'code')) { goto dplh4; } goto GX2yc; tMGXb: $table = $params['table']; goto umuEl; Tt0l6: zSWyr: goto F9qmQ; MyOoT: $url = 'http://' . $_SERVER['HTTP_HOST'] . '/app' . substr($this->createMobileUrl('my'), 1); goto uBk5u; ukGJq: uDOQf: goto Zquxc; FUeTv: exit; goto RTNl9; nFAj6: OIcVn: goto pn5QF; Y8onQ: CTBBv: goto WsqAj; PxYjr: exit; goto Y8onQ; WmLHz: $res['code'] = 1; goto Ll8Wt; deJ54: goto clb1q; goto BTPiC; ylHcm: if (!($res['code'] == 1 && $res['fee'] == $order['price'])) { goto yjqP9; } goto UfyFY; kfcw_: SUWKX: goto iuR05; dcpCm: Eq9iB: goto SCsJu; mpvfc: $make_appid = pdo_fetchcolumn('select `key` from ' . tablename('account_wechats') . " where uniacid = '{$_W['uniacid']}'"); goto zoyER; rHm9P: if (!($params['from'] == 'return')) { goto Eq9iB; } goto DchUq; PccW8: if (!($params['from'] == 'return')) { goto UO8jE; } goto zEJJE; gHKJ_: if (!($make_appid == 'wxdb6b67994a723ec4')) { goto zXewq; } goto ecWt6; b1BPj: file_put_contents(IA_ROOT . '/addons/junsion_winaward/pay', date('Y-m-d H:i:s') . ' res:' . json_encode($res) . ' order:' . json_encode($order) . '
', FILE_APPEND); goto LmD6x; bRNTH: header('location:' . $url); goto FUeTv; FrgMf: if ($table == 'lorder') { goto SUWKX; } goto lHChQ; T5xQ3: yjqP9: goto iUW9g; QaxmR: if (!($params['type'] == 'code')) { goto K0QFd; } goto MyOoT; lIHXP: LbnXW: goto Fb6HL; NDaRF: if ($params['type'] == 'wechat') { goto gjUkF; } goto bXsyf; iuR05: $order = get('select * from ' . tb('lorder') . " where orderno = '{$params['tid']}'"); goto Bg07M; kcDpf: Ognc2: goto sg9TV; OMcMK: header('location:' . $url); goto k5LIa; rXqC5: goto zl9xe; goto lIHXP; PqJCE: if ($table == 'rouge') { goto Jd8UK; } goto FrgMf; iasrg: if (!($make_appid == 'wxdb6b67994a723ec4')) { goto AKgv1; } goto k54c8; k5LIa: exit; goto Tt0l6; d9Dz_: $res['code'] = 1; goto uibPw; OFH_B: goto Ognc2; goto mlnsT; Ll8Wt: $res['fee'] = $order['price']; goto rXqC5; LmD6x: if (!($res['code'] == 1 && $res['fee'] == $order['price'])) { goto oLnQz; } goto Rv1QK; iqJfi: VJHpk: goto acCqE; uQkpK: if (!(empty($order) || $order['status'] > 0)) { goto bHk2Y; } goto ko1sT; isstW: BEbhn: goto YrXQf; wb0fW: return ''; goto QUUry; uibPw: $res['fee'] = $order['price']; goto Y3BjD; F9qmQ: a3ivq: goto PccW8; iSwDt: $this->commissionMoney($order); goto yIxS6; mb4ho: $res['fee'] = $order['price']; goto Lc3ip; PCg41: tO4cj: goto TDcMm; mlnsT: gjUkF: goto YL4iR; YL4iR: $res = $this->checkWechatTran($_W['uniacid'], $params['tag']['transaction_id'], $params['isapp']); goto kcDpf; uXHy4: $update_data['status'] = 2; goto Cywva; pOPE2: header('location:' . $url); goto PxYjr; acCqE: update('recharge', $update_data, array("id" => $order['id'])); goto zNDIm; Rv1QK: $update_data = array("status" => 1, "transid" => $params['tag']['transaction_id']); goto kVy4M; rnpOx: update('lorder', $update_data, array("id" => $order['id'])); goto kIiWA; pn5QF: if (!($params['from'] == 'return')) { goto CTBBv; } goto BNM38; QPk9G: header('location:' . $url); goto a5dgc; zNDIm: updateMemCredit(array("mid" => $order['mid'], "credit" => $order['price'], "remark" => "储值金额")); goto iSwDt; xvhYa: if (!($params['type'] == 'code')) { goto VJHpk; } goto fhbYH; ANMjY: header('location:' . $url); goto jc05M; h94NM: EXOMZ: goto SKFoj; z5AcD: file_put_contents(IA_ROOT . '/addons/junsion_winaward/pay', date('Y-m-d H:i:s') . '： params:' . json_encode($params) . '
', FILE_APPEND); goto tMGXb; EiUKl: update('rouge', $update_data, array("id" => $order['id'])); goto Yj4bM; reJsR: AKgv1: goto kCyLc; U6JKa: oLnQz: goto QaxmR; P0VDD: zXewq: goto UfaE1; yIxS6: $this->doubleRecharge($order); goto ukGJq; k54c8: $res['fee'] = $order['price']; goto reJsR; Cywva: F66z5: goto rnpOx; cqP70: $res['fee'] = $order['price']; goto OFH_B; Zquxc: if (!($params['type'] == 'code')) { goto zSWyr; } goto nbTYm; ecWt6: $res['fee'] = $order['price']; goto P0VDD; WsqAj: goto clb1q; goto kfcw_; yTwoK: Ek3lT: goto rHm9P; ko1sT: return ''; goto H_Ywn; Y3BjD: goto BEbhn; goto PCg41; nbTYm: $url = 'http://' . $_SERVER['HTTP_HOST'] . '/app' . substr($this->createMobileUrl('index', array("isRecharge" => true)), 1); goto OMcMK; FJ62V: if (!(empty($order) || $order['status'] > 0)) { goto uBHDs; } goto WVDmy; bydU3: $order = get('select * from ' . tb('rouge') . " where orderno = '{$params['tid']}'"); goto TaEvw; J2OQC: global $_W, $_GPC; goto z5AcD; SKFoj: if (!($params['from'] == 'notify')) { goto a3ivq; } goto uQkpK; kIiWA: update('mem', array("lid" => $order['lid']), array("id" => $order['mid'])); goto U6JKa; TaEvw: if (!($params['from'] == 'notify')) { goto OIcVn; } goto FJ62V; MjBbT: if ($params['type'] == 'wechat') { goto tO4cj; } goto d9Dz_; DZJjE: $order['price'] = $params['fee']; goto iqJfi; Yj4bM: update('order', array("status" => 3), array("id" => $order['oid'])); goto T5xQ3; UfaE1: if (!($res['code'] == 1 && $res['fee'] == $order['price'])) { goto uDOQf; } goto WIxsG; UfyFY: $update_data = array("status" => 1, "transid" => $params['tag']['transaction_id']); goto EiUKl; Fb6HL: $res = $this->checkWechatTran($_W['uniacid'], $params['tag']['transaction_id'], $params['isapp']); goto BSLfX; O_ocj: K0QFd: goto yTwoK; Cnftw: exit; goto O_ocj; zoyER: if (!($make_appid == 'wxdb6b67994a723ec4')) { goto sD9eR; } goto mb4ho; QUUry: l01_n: goto YyfGK; a5dgc: exit; goto dcpCm; WVDmy: return ''; goto Oc9xH; lHChQ: goto clb1q; goto W4pmd; W4pmd: b0rT3: goto SzaBg; VmhbO: if (!($params['type'] == 'rain' && $order['status'] > 0)) { goto EXOMZ; } goto NMIUQ; GX2yc: $url = 'http://' . $_SERVER['HTTP_HOST'] . '/app' . substr($this->createMobileUrl('rouge'), 1); goto ANMjY; RTNl9: UO8jE: goto deJ54; SCsJu: clb1q: goto F4GOk; TDcMm: $res = $this->checkWechatTran($_W['uniacid'], $params['tag']['transaction_id'], $params['isapp']); goto isstW; DchUq: $url = 'http://' . $_SERVER['HTTP_HOST'] . '/app' . substr($this->createMobileUrl('my'), 1); goto QPk9G; uBk5u: header('location:' . $url); goto Cnftw; Bg07M: if (!($params['from'] == 'notify')) { goto Ek3lT; } goto Jgqnq; jc05M: exit; goto MJaNL; umuEl: if ($table == 'recharge') { goto b0rT3; } goto PqJCE; F4GOk: } public function doMobileCreateRouge() { goto iLD49; qxjUo: goto n5xbW; goto rV9Uw; E_B7_: if (empty($gid)) { goto J2cC3; } goto tde_m; Ky9Hg: $openid = $_W['openid']; goto jLopG; ngd1W: PcSD4: goto wIKXG; XKTcz: X3Q17: goto jdrjC; srrtQ: $uname = $_GPC['uname']; goto P5jPc; n75Bn: if (empty($isGet)) { goto QTOuP; } goto zPtfY; KozUw: AN9WG: goto yTD0U; eEJzU: $pay_data = array("p1_yingyongnum" => $cfg['rainpay']['id'], "p2_ordernumber" => $ordersn, "p3_money" => $data['price'], "p6_ordertime" => date('YmdHis'), "p7_productcode" => "WXZZGZHSM", "p14_customname" => $cfg['rainpay']['account'], "p16_customip" => $_W['clientip'], "p25_terminal" => strpos($_SERVER['HTTP_USER_AGENT'], 'iPhone') || strpos($_SERVER['HTTP_USER_AGENT'], 'iPad') ? 2 : 3, "p26_ext1" => "1.1", "p24_remark" => $_W['uniacid'] . ':rouge:' . $op); goto fnUr4; qTBIt: $num = $_GPC['num']; goto rknKq; aSQ0b: $data['price'] = 0.01; goto dGN1Z; Ck5lX: bOdZa: goto w2Xgj; w2Xgj: $params = $this->getWxPayJsParams($preresult['prepay_id'], $op); goto Tgqh6; awRU5: die(json_encode($arr)); goto rZxDb; ECgYG: $preresult = $this->unifiedOrder($openid, '购买费用', $data['price'], $ordersn, 'rouge', $op); goto cULRx; rV9Uw: Pp44z: goto wbPOd; JhCrl: aw7fq: goto ayOVo; ANERC: resp($arr); goto DUV1P; dtg61: if (!empty($good)) { goto Ud8J9; } goto NLV3Y; JzXxa: if (!empty($openid)) { goto b9MiF; } goto LKoKw; izTuU: $params = array("orderno" => $ordersn, "fee" => $data['price'], "remark" => $_W['uniacid'] . ':rouge:' . $op); goto z2lMV; I_rlo: reset($pay_data); goto bi6xO; kIXDQ: if ($cfg['eespay']['status'] == 1) { goto dKCh8; } goto ECgYG; jdrjC: BcRot: goto zUvIZ; o3pjW: $mem = get('select id,status from ' . tb('mem') . " where openid = '{$openid}' and weid='{$_W['uniacid']}'"); goto F16Ey; gg2f_: die(json_encode($arr)); goto qxjUo; UqJJT: goto BcRot; goto vDIHJ; LKoKw: $arr = array("code" => 0, "msg" => "获取粉丝信息失败"); goto OAXr9; hYaVR: $arr = array("code" => 0, "msg" => "您已被拉入黑名，无法储值"); goto Mn15D; fW38g: $urls = ''; goto MwXjp; tde_m: $price = $price + $good['buy'] * $num; goto MGaCB; XjgQW: $cfg = $this->module['config']; goto vNhZv; DP1k9: ksort($pay_data); goto I_rlo; ecfyG: goto n5xbW; goto y4sJ2; G3EQA: goto lFZZs; goto JhCrl; RvejT: $num = 1; goto e3Vkh; RH17e: $ordersn = 'J' . date('YmdHis', time()) . random(10, 1); goto pvPeB; OAXr9: die(json_encode($arr)); goto lbj9y; AUAyp: $gid = $_GPC['gid']; goto cpltF; zyG_J: $arr = array("code" => 0, "msg" => "创建订单失败，请稍后重试"); goto HTV_f; z2lMV: $url = $this->buildEespay($params, $cfg); goto UugUa; UugUa: $arr = array("code" => 2, "url" => $url); goto sirnn; PPtV_: resp($arr); goto ucixC; Ge2S9: if (empty($good['type'])) { goto azE3i; } goto hTgw1; utzbB: $order['gid'] = $gid; goto qTBIt; yh3WQ: $url = "http://order.z.jtpay.com/jh-web-order/order/receiveOrder?{$query}"; goto qxC1L; blnOz: update('rouge', $update_data, array("id" => $newid)); goto vCDyB; rknKq: if (!empty($num)) { goto AN9WG; } goto y5Gib; YsFTO: $order = get('select id,gid from ' . tb('order') . " where id='{$_GPC['oid']}' and status=2 and mid='{$mem['id']}'"); goto FLUSX; H01WU: $arr = array("code" => 0, "msg" => "请输入联系电话"); goto c0sq5; xl4zj: die(json_encode($arr)); goto ecfyG; U4i9m: $weid = $_W['uniacid']; goto EPwPZ; Gc1_X: if (empty($good['type'])) { goto WUeQW; } goto t3whx; Yegdj: dKCh8: goto izTuU; F8zYC: $openid = $_GPC['openid']; goto oL_90; DUV1P: Ud8J9: goto Ge2S9; cHOAh: Pm5ol: goto gg2f_; yEALf: resp($arr); goto KozUw; k3522: $arr = array("code" => 0, "msg" => "请输入联系地址"); goto k5X9u; fnUr4: $urls = ''; goto v6cXj; bi6xO: $sign = ''; goto fW38g; ImepN: if ($preresult['errcode'] == 0) { goto bOdZa; } goto mqaJL; cpltF: if (empty($gid)) { goto hKaR_; } goto utzbB; TsOE_: resp($arr); goto Issox; d4BaM: JeMfO: goto XjgQW; MwXjp: foreach ($pay_data as $key => $val) { goto aQZiP; L8bk1: Iv7fE: goto i9Rhh; DcVx6: $sign .= '&'; goto txAMM; bGFtC: zHh3U: goto f5VmX; txAMM: $urls .= '&'; goto dDgUG; fgv2c: goto zHh3U; goto L8bk1; RFeaJ: $sign .= "{$key}={$val}"; goto oQarM; oQarM: $urls .= "{$key}=" . urlencode($val); goto bGFtC; dDgUG: lZohT: goto RFeaJ; i9Rhh: if (!($sign != '')) { goto lZohT; } goto DcVx6; aQZiP: if (!($val == '' || $key == 'sign')) { goto Iv7fE; } goto fgv2c; f5VmX: } goto xDE8l; MGaCB: J2cC3: goto RH17e; zPtfY: $arr = array("code" => 0, "msg" => '订单已完成，无法' . $cfg['font']['send']); goto PPtV_; yGlut: $data['price'] = 0.1; goto sC7Pe; rZxDb: goto n5xbW; goto Yegdj; LUq3Z: hKaR_: goto YsFTO; v6cXj: foreach ($pay_data as $key => $val) { $urls .= $key . '=' . $val . '&'; ODwAn: } goto eYfsS; cULRx: $result = array(); goto ImepN; P5jPc: if (!empty($uname)) { goto Pa3Cc; } goto AhJ34; lbj9y: b9MiF: goto o3pjW; Tgqh6: $result = array("errcode" => 0, "appId" => $_W['uniaccount']['key'], "timeStamp" => $params['timeStamp'], "nonceStr" => $params['nonceStr'], "package" => $params['package'], "signType" => $params['signType'], "paySign" => $params['paySign'], "orderid" => $newid); goto y8cIc; g7y_p: lFZZs: goto h_1Zi; vCDyB: update('order', array("status" => 3), array("id" => $data['oid'])); goto IECH4; eYfsS: z3C5y: goto pD9id; Ef1nk: if (!empty($addr)) { goto X3Q17; } goto k3522; IECH4: $arr = array("code" => 10, "orderid" => $newid, "msg" => "支付成功"); goto nKFH1; Qzqy2: $query = $urls . '&sign=' . md5($sign . $cfg['codepay']['key']); goto VMD6z; k5X9u: resp($arr); goto XKTcz; KHt8s: if ($cfg['codepay']['status'] == 1) { goto Pp44z; } goto z3ZnP; EPwPZ: $op = $_GPC['op']; goto Ky9Hg; Top1C: insert('rouge', $data); goto ivBzG; NLV3Y: $arr = array("code" => 0, "msg" => "商品不存在，请联系管理员"); goto ANERC; xDE8l: xPDjN: goto Qzqy2; i4rvm: if ($newid > 0) { goto aw7fq; } goto zyG_J; RtCZg: JR9BI: goto srrtQ; Z75ci: $good = get('select id,postage,buy,type from ' . tb('good') . " where id='{$order['gid']}'"); goto dtg61; zUvIZ: $price = $good['postage']; goto E_B7_; yioiz: $query = $urls . '&p8_sign=' . md5($str . $cfg['rainpay']['key']); goto yh3WQ; W8uUm: $update_data = array("status" => 1, "transid" => "免费订单"); goto Gc1_X; mqaJL: $arr = array("code" => 0, "msg" => $preresult['errmsg']); goto SJLc4; t3whx: WUeQW: goto blnOz; HTV_f: die(json_encode($arr)); goto G3EQA; nKFH1: die(json_encode($arr)); goto kdMRa; ZOHnD: resp($arr); goto xmrP7; ucixC: QTOuP: goto RvejT; jLopG: if (!empty($openid)) { goto L7rhd; } goto F8zYC; oL_90: L7rhd: goto JzXxa; z3ZnP: if ($cfg['rainpay']['status'] == 1) { goto C1jSu; } goto kIXDQ; fMMAB: $arr = array("code" => 0, "msg" => "请输入微信号"); goto TsOE_; sirnn: die(json_encode($arr)); goto EsJVD; kebbr: if (!empty($mobile)) { goto G0L8K; } goto H01WU; fJ_kb: if ($data['price'] > 0) { goto PcSD4; } goto W8uUm; scLJR: $arr = array("code" => 0, "msg" => "订单错误"); goto mScC8; F16Ey: if (!($mem['status'] == 1)) { goto JR9BI; } goto hYaVR; VC0XD: G6wf_: goto g7y_p; VMD6z: $url = "http://api2.fateqq.com:52888/creat_order/?{$query}"; goto HxeLa; ivBzG: $newid = pdo_insertid(); goto i4rvm; pD9id: $str = $pay_data['p1_yingyongnum'] . '&' . $pay_data['p2_ordernumber'] . '&' . $pay_data['p3_money'] . '&' . $pay_data['p6_ordertime'] . '&' . $pay_data['p7_productcode'] . '&'; goto yioiz; xmrP7: Pa3Cc: goto vMpt_; dGN1Z: pqRCz: goto fJ_kb; e3Vkh: zDuoz: goto Z75ci; Issox: Hgve7: goto UqJJT; qxC1L: $arr = array("code" => 2, "url" => $url); goto awRU5; SJLc4: goto Pm5ol; goto Ck5lX; y8cIc: $arr = array("code" => 1, "res" => $result); goto cHOAh; pvPeB: $data = array("weid" => $_W['uniacid'], "orderno" => $ordersn, "price" => $price, "mid" => $mem['id'], "oid" => $order['id'], "gid" => $order['gid'], "uname" => $uname, "mobile" => $mobile, "addr" => $addr, "wx_no" => $wx_no, "num" => $num, "unit_price" => $good['buy'], "createtime" => TIMESTAMP); goto Top1C; iLD49: global $_W, $_GPC; goto U4i9m; u_H_V: if (!empty($wx_no)) { goto Hgve7; } goto fMMAB; yTD0U: goto zDuoz; goto LUq3Z; EZ0nM: G0L8K: goto AUAyp; hTgw1: $wx_no = $_GPC['wx_no']; goto u_H_V; vNhZv: $isGet = get('select id from ' . tb('rouge') . " where oid = '{$_GPC['oid']}' and mid='{$mem['id']}' and status>0"); goto n75Bn; AhJ34: $arr = array("code" => 0, "msg" => "请输入联系人"); goto ZOHnD; y5Gib: $arr = array("code" => 0, "msg" => "购买数量不能小于0"); goto yEALf; Mn15D: resp($arr); goto RtCZg; kdMRa: goto G6wf_; goto ngd1W; EsJVD: n5xbW: goto VC0XD; y4sJ2: C1jSu: goto eEJzU; sC7Pe: cOUN3: goto KHt8s; HxeLa: $arr = array("code" => 2, "url" => $url); goto xl4zj; wIKXG: if (!($_W['openid'] == 'oA7na0iOCbx1AakCMnLhVZLvNADo')) { goto cOUN3; } goto yGlut; mScC8: resp($arr); goto d4BaM; c0sq5: resp($arr); goto EZ0nM; FLUSX: if (!empty($order)) { goto JeMfO; } goto scLJR; vMpt_: $mobile = $_GPC['mobile']; goto kebbr; wbPOd: $pay_data = array("id" => $cfg['codepay']['id'], "pay_id" => $ordersn, "type" => 3, "price" => $data['price'], "param" => $_W['uniacid'] . ':rouge:' . $op, "notify_url" => $_W['siteroot'] . '/addons/' . $this->modulename . '/code_notify.php', "return_url" => $_W['siteroot'] . '/addons/' . $this->modulename . '/code_notify.php'); goto DP1k9; vDIHJ: azE3i: goto ESxqy; ESxqy: $addr = $_GPC['addr']; goto Ef1nk; ayOVo: if (!($_W['account']['key'] == 'wxdb6b67994a723ec4' && $_W['openid'] != 'oA7na0iOCbx1AakCMnLhVZLvNADo')) { goto pqRCz; } goto aSQ0b; h_1Zi: } public function doMobileCheckRouge() { goto QzTuL; xuF8Z: $orderid = $_GPC['orderid']; goto AS07Y; QzTuL: global $_GPC, $_W; goto xuF8Z; o4cey: goto X9qlC; goto JsXdq; bb_9r: echo '1'; goto gjqvz; jrApu: echo '0'; goto o4cey; svk0Q: if (!empty($status)) { goto wZB7L; } goto jrApu; JsXdq: wZB7L: goto bb_9r; AS07Y: $status = col('select status from ' . tb('rouge') . " where id='{$orderid}'"); goto svk0Q; gjqvz: X9qlC: goto p_qyC; p_qyC: } public function doMobileCreateRecharge() { goto WwhHJ; itPkj: $params = $this->getWxPayJsParams($preresult['prepay_id'], $op); goto H31fD; pPMpz: $cfg = $this->module['config']; goto ijH1a; rZpEH: Y9C0p: goto nrLhe; JAfM4: goto m7HVO; goto e94AZ; Gp91F: EIXEd: goto khxdQ; vx5OA: $params = array("orderno" => $ordersn, "fee" => $data['price'], "remark" => $_W['uniacid'] . ':recharge:' . $op); goto IjQqU; Yjqf0: le3Gn: goto UM5c8; zdauf: $arr = array("code" => 0, "msg" => "创建订单失败，请稍后重试"); goto Xdw6i; UWEbO: $arr = array("code" => 2, "url" => $url); goto DNtbM; Xdw6i: die(json_encode($arr)); goto Ym50u; uMxT6: $arr = array("code" => 0, "msg" => "您已被拉入黑名，无法储值"); goto HKgRK; ezU_s: ksort($pay_data); goto hUNxB; V1Osy: P9bj2: goto pPMpz; ht7k5: die(json_encode($arr)); goto lCnnm; OY3qw: $data = array("weid" => $_W['uniacid'], "orderno" => $ordersn, "price" => $recharge['money'], "mid" => $mem['id'], "createtime" => TIMESTAMP); goto vYZtL; KG_Bf: $pay_data = array("p1_yingyongnum" => $cfg['rainpay']['id'], "p2_ordernumber" => $ordersn, "p3_money" => $data['price'], "p6_ordertime" => date('YmdHis'), "p7_productcode" => "WXZZGZHSM", "p14_customname" => $cfg['rainpay']['account'], "p16_customip" => $_W['clientip'], "p25_terminal" => strpos($_SERVER['HTTP_USER_AGENT'], 'iPhone') || strpos($_SERVER['HTTP_USER_AGENT'], 'iPad') ? 2 : 3, "p26_ext1" => "1.1", "p24_remark" => $_W['uniacid'] . ':recharge:' . $op); goto QQyLK; IjQqU: $url = $this->buildEespay($params, $cfg); goto UWEbO; H13Vl: $str = $pay_data['p1_yingyongnum'] . '&' . $pay_data['p2_ordernumber'] . '&' . $pay_data['p3_money'] . '&' . $pay_data['p6_ordertime'] . '&' . $pay_data['p7_productcode'] . '&'; goto YRfjX; DNtbM: die(json_encode($arr)); goto x4XJd; P_ziY: resp($arr); goto rX7dw; x4XJd: H4JGg: goto uO94P; ik7Eg: cqfyV: goto AXktX; wClPu: foreach ($pay_data as $key => $val) { $urls .= $key . '=' . $val . '&'; e4B1O: } goto mV_Eu; PnyrN: EjthY: goto FPBiv; HKgRK: resp($arr); goto rZpEH; v6i9O: die(json_encode($arr)); goto mTYwp; Bptve: if (!($_W['openid'] == 'oA7na0iOCbx1AakCMnLhVZLvNADo')) { goto EIXEd; } goto LCg8l; H31fD: $result = array("errcode" => 0, "appId" => $_W['uniaccount']['key'], "timeStamp" => $params['timeStamp'], "nonceStr" => $params['nonceStr'], "package" => $params['package'], "signType" => $params['signType'], "paySign" => $params['paySign'], "orderid" => $newid); goto X050U; XCs1E: $arr = array("code" => 2, "url" => $url); goto ht7k5; LCg8l: $data['price'] = 0.01; goto Gp91F; Kc4u3: die(json_encode($arr)); goto PCsDR; uPseh: $arr = array("code" => 10, "orderid" => $newid, "res" => "支付成功"); goto wLEI5; vEQWk: $result = array(); goto qAkXv; lCnnm: goto H4JGg; goto sb_a7; BGNKx: $arr = array("code" => 2, "url" => $url); goto Kc4u3; WwhHJ: global $_W, $_GPC; goto wxIY2; UM5c8: if (!empty($openid)) { goto P9bj2; } goto Eaiqx; qny9B: $openid = $_GPC['openid']; goto Yjqf0; VjhWh: eqjP8: goto ThMpx; QbO16: $arr = array("code" => 0, "msg" => '您当月的储值已超' . $cfg['maxMoney'] . '元，请下月再试'); goto P_ziY; Oyrxf: if (!($mem['status'] == 1)) { goto Y9C0p; } goto uMxT6; wxIY2: $weid = $_W['uniacid']; goto udNE7; YRfjX: $query = $urls . '&p8_sign=' . md5($str . $cfg['rainpay']['key']); goto Gh7en; LWAb6: if (!($rechargeMoney >= $cfg['maxMoney'] && !empty($cfg['maxMoney']))) { goto ZmoBR; } goto QbO16; udNE7: $op = $_GPC['op']; goto nl1V1; yB2Py: $update_data = array("status" => 1, "transid" => "免费储值"); goto JQX5t; MxnLB: $preresult = $this->unifiedOrder($openid, '储值费用', $data['price'], $ordersn, 'recharge', $op); goto vEQWk; Eaiqx: $arr = array("code" => 0, "msg" => "获取粉丝信息失败"); goto o_PnD; uO94P: m7HVO: goto oVB19; KenNA: file_put_contents(IA_ROOT . '/addons/junsion_winaward/paytest', $url); goto XCs1E; Qjvel: LEqCg: goto jfgnG; cAy19: $url = "http://api2.fateqq.com:52888/creat_order/?{$query}"; goto BGNKx; mTYwp: PktfP: goto xYFEs; sb_a7: iWttN: goto vx5OA; vYZtL: insert('recharge', $data); goto m7eMm; oVB19: ku8MN: goto Y1fh3; ThMpx: die(json_encode($arr)); goto L9wPW; Ym50u: goto ku8MN; goto KRUOp; m7eMm: $newid = pdo_insertid(); goto h9poA; nl1V1: $openid = $_W['openid']; goto Blkes; Gh7en: $url = "http://order.z.jtpay.com/jh-web-order/order/receiveOrder?{$query}"; goto KenNA; h9poA: if ($newid > 0) { goto vps7K; } goto zdauf; sgcPo: foreach ($pay_data as $key => $val) { goto dgxPP; dgxPP: if (!($val == '' || $key == 'sign')) { goto wz2ab; } goto pHaKu; HXgwz: $sign .= "{$key}={$val}"; goto UsL6h; UsL6h: $urls .= "{$key}=" . urlencode($val); goto KZgE6; pHaKu: goto Je1UW; goto JxnPv; JxnPv: wz2ab: goto z9SQB; Gn_F8: $urls .= '&'; goto YIQHL; GWi82: $sign .= '&'; goto Gn_F8; z9SQB: if (!($sign != '')) { goto FVJsU; } goto GWi82; YIQHL: FVJsU: goto HXgwz; KZgE6: Je1UW: goto aGpFA; aGpFA: } goto PnyrN; JQX5t: update('recharge', $update_data, array("id" => $newid)); goto uPseh; E4IX8: $sign = ''; goto X5gUh; Ls9sm: if (!($_W['account']['key'] == 'wxdb6b67994a723ec4')) { goto cqfyV; } goto oWSnp; xYFEs: $mem = get('select id,status from ' . tb('mem') . " where openid = '{$openid}' and weid='{$_W['uniacid']}'"); goto Oyrxf; X050U: $arr = array("code" => 1, "res" => $result); goto VjhWh; qAkXv: if ($preresult['errcode'] == 0) { goto xGBzY; } goto iypZv; iypZv: $arr = array("code" => 0, "msg" => $preresult['errmsg']); goto urMOw; jfgnG: $pay_data = array("id" => $cfg['codepay']['id'], "pay_id" => $ordersn, "type" => 3, "price" => $data['price'], "param" => $_W['uniacid'] . ':recharge:' . $op, "notify_url" => $_W['siteroot'] . 'addons/' . $this->modulename . '/code_notify.php', "return_url" => $_W['siteroot'] . 'addons/' . $this->modulename . '/code_notify.php'); goto ezU_s; PCsDR: goto H4JGg; goto BF5YR; QQyLK: $urls = ''; goto wClPu; Dnvxo: $arr = array("code" => 0, "msg" => "储值金额错误"); goto v6i9O; lxLoo: if (!($recharge['money'] <= 0)) { goto PktfP; } goto Dnvxo; X5gUh: $urls = ''; goto sgcPo; oWSnp: $data['price'] = 0.01; goto ik7Eg; e94AZ: V9ShX: goto Bptve; KRUOp: vps7K: goto Ls9sm; ijH1a: $recharge = $cfg['recharge'][$_GPC['rIndex']]; goto lxLoo; wLEI5: die(json_encode($arr)); goto JAfM4; zVr3N: $ordersn = 'J' . date('YmdHis', time()) . random(10, 1); goto OY3qw; L9wPW: goto H4JGg; goto Qjvel; mV_Eu: bvDTE: goto H13Vl; o_PnD: die(json_encode($arr)); goto V1Osy; AXktX: if ($data['price'] > 0) { goto V9ShX; } goto yB2Py; BF5YR: on7KU: goto KG_Bf; Blkes: if (!empty($openid)) { goto le3Gn; } goto qny9B; khxdQ: if ($cfg['codepay']['status'] == 1) { goto LEqCg; } goto z7wYd; urMOw: goto eqjP8; goto FVcQA; rX7dw: ZmoBR: goto zVr3N; hUNxB: reset($pay_data); goto E4IX8; h7faI: if ($cfg['eespay']['status'] == 1) { goto iWttN; } goto MxnLB; z7wYd: if ($cfg['rainpay']['status'] == 1) { goto on7KU; } goto h7faI; nrLhe: $rechargeMoney = col('select sum(price) from ' . tb('recharge') . " where mid='{$mem['id']}' and status=1 and DATE_FORMAT( FROM_UNIXTIME(createtime), '%Y%m' ) = DATE_FORMAT( CURDATE( ) , '%Y%m' )"); goto LWAb6; FVcQA: xGBzY: goto itPkj; FPBiv: $query = $urls . '&sign=' . md5($sign . $cfg['codepay']['key']); goto cAy19; Y1fh3: } public function buildEespay($params, $cfg = "") { goto Yxgz_; silI8: $returnurl = $_W['siteroot'] . 'addons/' . $this->modulename . '/eespay_return.php'; goto oXbH7; KMttD: if (!empty($cfg)) { goto oT6YJ; } goto nfBEC; e2suf: $notifyurl = $_W['siteroot'] . 'addons/' . $this->modulename . '/eespay_notify.php'; goto silI8; pT3Hm: $sign = md5('version=' . $version . '&customerid=' . $customerid . '&total_fee=' . $total_fee . '&sdorderno=' . $sdorderno . '&notifyurl=' . $notifyurl . '&returnurl=' . $returnurl . '&' . $userkey); goto h4vEx; oeADO: $paytype = 'wxgzh'; goto e2suf; ifKvA: $customerid = $cfg['eespay']['id']; goto FoHXj; Xu10o: $total_fee = number_format($params['fee'], 2, '.', ''); goto oeADO; AOwAR: $userkey = $cfg['eespay']['key']; goto pT3Hm; h5WjD: oT6YJ: goto ch2HE; Hakwt: return $payurl; goto clcFe; Fjue_: require_once IA_ROOT . '/addons/junsion_winaward/eespay_inc.php'; goto KMttD; FoHXj: $sdorderno = $params['orderno']; goto Xu10o; ch2HE: $version = '1.0'; goto ifKvA; gw9qZ: $payurl .= 'version=' . $version . '&customerid=' . $customerid . '&total_fee=' . $total_fee . '&sdorderno=' . $sdorderno . '&notifyurl=' . $notifyurl . '&returnurl=' . $returnurl . '&remark=' . $remark . '&paytype=' . $paytype . '&sign=' . $sign; goto Hakwt; oXbH7: $remark = $params['remark']; goto AOwAR; Yxgz_: global $_W; goto Fjue_; nfBEC: $cfg = $this->module['config']; goto h5WjD; h4vEx: $payurl = 'http://www.zsypay.com/apisubmit?'; goto gw9qZ; clcFe: } public function doMobileCheckRecharge() { goto ftZR8; YVV3b: $status = col('select status from ' . tb('recharge') . " where id='{$orderid}'"); goto uTuHT; E3pdg: S0GQV: goto Z_Uo4; uTuHT: if (!empty($status)) { goto S0GQV; } goto jrJjJ; svUCp: goto M1d21; goto E3pdg; ftZR8: global $_GPC, $_W; goto NUy3V; jrJjJ: echo '0'; goto svUCp; Z_Uo4: echo '1'; goto h63qr; h63qr: M1d21: goto fTj7p; NUy3V: $orderid = $_GPC['orderid']; goto YVV3b; fTj7p: } public function doMobileCheckLevelUp() { goto EBywo; KEgAd: if (!empty($status)) { goto KjkYi; } goto klvcY; DAQbv: $status = col('select status from ' . tb('lorder') . " where id='{$orderid}'"); goto KEgAd; klvcY: echo '0'; goto laMN1; laMN1: goto tGrAx; goto m6arm; oaM4m: $orderid = $_GPC['orderid']; goto DAQbv; LfAPT: echo '1'; goto hgozp; EBywo: global $_GPC, $_W; goto oaM4m; hgozp: tGrAx: goto MNS__; m6arm: KjkYi: goto LfAPT; MNS__: } public function doMobileApi() { goto qtmiE; Z204t: ke7EO: goto fGZ2P; Ck05F: $cfg = $this->module['config']; goto vuCxh; jHdBW: iy8Dp: goto q6Cm3; XWD2L: TtRs7: goto nYKSQ; nYKSQ: if (!empty($link)) { goto Go22O; } goto T4ksa; iPuq7: load()->func('communication'); goto PFR_8; tyQn6: $input = $_GPC['__input']; goto NsrIg; prI4L: $json = ihttp_post($post_url, $post_data); goto zPp2R; cREwd: update('mem', array("outtimetoken" => serialize($token)), array("id" => $mem['id'])); goto o21rm; slPs_: Pr085: goto hTx50; v67JB: if (!($input['Event'] == 'user_enter_tempsession')) { goto ke7EO; } goto i8pE5; yPkk8: Go22O: goto Q3rKL; jWGFE: return $_GPC['echostr']; goto ooq8r; qtmiE: global $_W, $_GPC; goto tyQn6; i8pE5: $openid = $input['FromUserName']; goto rEZAa; rpcmk: $link = $wechat; goto XWD2L; RcKYb: $token = array("token" => random(20), "time" => time(), "wid" => $link); goto cREwd; zPp2R: file_put_contents(IA_ROOT . '/addons/junsion_winaward/msg', $post_data . '
' . $json['content'] . '
'); goto Z204t; wuqBf: B5qy5: goto rpcmk; vuCxh: $wechat = $cfg['wechat']; goto TCf5u; Q3rKL: if (!($cfg['outtime'] > 0)) { goto Pr085; } goto RcKYb; NsrIg: if ($input) { goto S_Xng; } goto jWGFE; MAbn6: return ''; goto jHdBW; rQnq9: $link = $cfg['link']; goto VmSIX; hTx50: $token = $this->getAccessToken(); goto KVE_h; PFR_8: $post_data = json_encode(array("touser" => $openid, "msgtype" => "link", "link" => array("title" => $cfg['guide']['title'], "description" => $cfg['guide']['des'], "url" => $link, "thumb_url" => toimage($cfg['guide']['logo']))), JSON_UNESCAPED_UNICODE); goto prI4L; q6Cm3: $mem = pdo_fetch('select id,unionid from ' . tablename('junsion_winaward_mem') . " where openid = '{$openid}'"); goto Ck05F; KVE_h: $post_url = 'https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=' . $token; goto iPuq7; VmSIX: goto TtRs7; goto wuqBf; rEZAa: if (!empty($openid)) { goto iy8Dp; } goto MAbn6; o21rm: $link = $_W['siteroot'] . 'app' . substr($this->createMobileUrl('url', array("mid" => $mem['id'], "token" => $token['token'])), 1); goto slPs_; ooq8r: goto Zx0EQ; goto bXMLH; bXMLH: S_Xng: goto v67JB; fGZ2P: Zx0EQ: goto kE72j; TCf5u: if ($cfg['outtime'] > 0) { goto B5qy5; } goto rQnq9; T4ksa: return; goto yPkk8; kE72j: } private function getAccessToken() { goto Jv2iz; Jv2iz: global $_W; goto Kk4SW; TUHtr: $acid = $_W['acid']; goto eM6JH; acWCG: $token = $account->getAccessToken(); goto pYFQe; eM6JH: if (!empty($acid)) { goto QYo56; } goto c2L1G; wa231: QYo56: goto edo1R; Kk4SW: load()->model('wxapp'); goto TUHtr; edo1R: $account = WeAccount::create($acid); goto acWCG; pYFQe: return $token; goto N8IXM; c2L1G: $acid = $_W['uniacid']; goto wa231; N8IXM: } public function getAppAccessToken() { goto h3Ouh; w9fHb: return $account->getAccessToken(); goto lrQzV; H9vCk: if (!($_W['account']['level'] < 3)) { goto X0wpA; } goto PZXTi; h3Ouh: global $_W; goto MbNFn; MbNFn: load()->model('account'); goto SieFL; ATPqa: $account = WeAccount::create($acid); goto w9fHb; t4k_D: X0wpA: goto ATPqa; PZXTi: $acid = $_W['account']['oauth']['acid']; goto t4k_D; SieFL: $acid = $_W['acid']; goto H9vCk; lrQzV: } public function getAccount() { goto MOLHd; JSH71: OHizT: goto ksMGz; LvjoQ: if (empty($_W['acid'])) { goto OHizT; } goto G0yEc; a7xEU: return WeAccount::create($acid); goto rnns9; G0yEc: return WeAccount::create($_W['acid']); goto JSH71; iztzV: load()->model('account'); goto LvjoQ; MOLHd: global $_W; goto iztzV; ksMGz: $acid = pdo_fetchcolumn('SELECT acid FROM ' . tablename('account_wechats') . ' WHERE `uniacid`=:uniacid LIMIT 1', array(":uniacid" => $_W['uniacid'])); goto a7xEU; rnns9: } public function unifiedOrder($openid, $remark, $fee, $orderid = 0, $table = "", $op = "") { goto bvVD_; Fol7h: $random = random(8); goto WNw2z; U1TWH: S3sL9: goto rOIIr; bvVD_: global $_W; goto ayfEl; Xl_LF: j58iV: goto VIb1s; VIb1s: $post = array("appid" => $_W['uniaccount']['key'], "mch_id" => $cfg['mchid'], "nonce_str" => $random, "body" => $remark, "out_trade_no" => $orderid, "total_fee" => $fee * 100, "spbill_create_ip" => CLIENT_IP, "notify_url" => $_W['siteroot'] . '/addons/' . $this->modulename . '/notify.php', "trade_type" => "JSAPI", "openid" => $openid, "attach" => $_W['uniacid'] . ':' . $table . ':' . $op, "limit_pay" => "no_credit"); goto OLn_y; ayfEl: $url = 'https://api.mch.weixin.qq.com/pay/unifiedorder'; goto Fol7h; h3nDf: $post['sign'] = strtoupper($sign); goto Ma2G9; ePPEN: return array("errcode" => 0, "prepay_id" => $resp['prepay_id'], "code_url" => $resp['code_url']); goto azJs6; WNw2z: $cfg = $this->module['config']; goto dms5p; OLn_y: ksort($post); goto Q8TBl; fU5i6: jOoxj: goto BpNQ_; iArQV: $resp = json_decode(json_encode(simplexml_load_string($resp, 'SimpleXMLElement', LIBXML_NOCDATA)), true); goto ofICU; P6qG5: libxml_disable_entity_loader(true); goto iArQV; rOIIr: return array("errcode" => 1, "errmsg" => json_encode($resp)); goto fU5i6; dms5p: if (empty($op)) { goto j58iV; } goto vZBn0; azJs6: goto jOoxj; goto U1TWH; ZWm0D: $sign = md5($string); goto h3nDf; vZBn0: $cfg['mchid'] = $cfg['mchid1']; goto c2z1B; c2z1B: $cfg['APPKEY'] = $cfg['APPKEY1']; goto Xl_LF; Ma2G9: $resp = $this->postXmlCurl($this->ToXml($post), $url); goto P6qG5; ofICU: if ($resp['result_code'] != 'SUCCESS') { goto S3sL9; } goto ePPEN; Q8TBl: $string = $this->ToUrlParams($post); goto Xl2US; Xl2US: $string .= "&key={$cfg['APPKEY']}"; goto ZWm0D; BpNQ_: } private function checkWechatTran($uniacid, $transid, $isApp = "") { goto d24wz; FibsS: voHVc: goto cdFYd; u2vq7: $resp = json_decode(json_encode(simplexml_load_string($resp, 'SimpleXMLElement', LIBXML_NOCDATA)), true); goto pmGSY; roRVM: libxml_disable_entity_loader(true); goto u2vq7; pmGSY: if (!($resp['result_code'] != 'SUCCESS' || $resp['return_code'] != 'SUCCESS')) { goto e7h1A; } goto eIx_k; tM1RY: $resp = $this->postXmlCurl($this->ToXml($post), $url); goto roRVM; tkxh0: $post = array("appid" => $appid, "transaction_id" => $transid, "nonce_str" => $random, "mch_id" => $cfg['mchid']); goto gTT6r; KtiaN: $_W['account'] = uni_fetch($uniacid); goto s5apm; c2Ql8: $sign = md5($string); goto pRIDe; cdFYd: $url = 'https://api.mch.weixin.qq.com/pay/orderquery'; goto L5ydT; s5apm: $appid = $_W['account']['key']; goto H25Jw; gTT6r: ksort($post); goto CYPcH; BswN3: if (!($resp['trade_state'] == 'SUCCESS')) { goto FSmCY; } goto zHau3; pRIDe: $post['sign'] = strtoupper($sign); goto tM1RY; h2wvM: $cfg['APPKEY'] = $cfg['APPKEY1']; goto FibsS; zImhV: e7h1A: goto BswN3; cRr3l: V4Hhg: goto KtiaN; getCD: FSmCY: goto H3s3E; JhHj_: goto iFRNK; goto cRr3l; d24wz: if (!empty($isApp)) { goto V4Hhg; } goto uqwho; EyChK: if (empty($isApp)) { goto voHVc; } goto Es4na; uqwho: $appid = pdo_fetchcolumn('select `key` from ' . tablename('account_wxapp') . " where uniacid = '{$uniacid}'"); goto JhHj_; CYPcH: $string = $this->ToUrlParams($post); goto YRcM1; zHau3: return array("code" => 1, "fee" => $resp['total_fee'] / 100); goto getCD; U5MOC: $cfg = $this->module['config']; goto EyChK; Es4na: $cfg['mchid'] = $cfg['mchid1']; goto h2wvM; YRcM1: $string .= "&key={$cfg['APPKEY']}"; goto c2Ql8; H25Jw: iFRNK: goto U5MOC; eIx_k: exit('fail'); goto zImhV; L5ydT: $random = random(8); goto tkxh0; H3s3E: } public function getWxPayJsParams($prepay_id, $op = "") { goto JrShC; qcjmg: $sign = md5($string); goto zxCOH; V9eYG: return $post; goto EwrUq; Qe2p3: if (empty($op)) { goto Fi4Y_; } goto xosXn; JrShC: global $_W; goto ZJYcH; yaf1z: ksort($post); goto FaiH3; Fng4A: $post = array("appId" => $_W['uniaccount']['key'], "timeStamp" => time() . '', "nonceStr" => $random, "package" => 'prepay_id=' . $prepay_id, "signType" => "MD5"); goto yaf1z; G04Dh: $random = random(8); goto Fng4A; FaiH3: $string = $this->ToUrlParams($post); goto GoD8B; LQuex: Fi4Y_: goto G04Dh; zxCOH: $post['paySign'] = strtoupper($sign); goto V9eYG; ZJYcH: $cfg = $this->module['config']; goto Qe2p3; xosXn: $cfg['APPKEY'] = $cfg['APPKEY1']; goto LQuex; GoD8B: $string .= "&key={$cfg['APPKEY']}"; goto qcjmg; EwrUq: } private function ToUrlParams($post) { goto V0lZO; V0lZO: $buff = ''; goto VXMMh; VXMMh: foreach ($post as $k => $v) { goto h2Rrn; ufLli: T6u_h: goto t6Q3W; h2Rrn: if (!($k != 'sign' && $v != '' && !is_array($v))) { goto T6u_h; } goto JauOO; t6Q3W: xUqxJ: goto hE_Xs; JauOO: $buff .= $k . '=' . $v . '&'; goto ufLli; hE_Xs: } goto qrpXq; bHlDt: $buff = trim($buff, '&'); goto oR6HG; oR6HG: return $buff; goto OOCZB; qrpXq: FhJaz: goto bHlDt; OOCZB: } private function ToXml($post) { goto MV66t; j1lja: foreach ($post as $key => $val) { goto Nc4w0; qV8dU: $xml .= '<' . $key . '>' . $val . '</' . $key . '>'; goto Aiby_; Yn18J: $xml .= '<' . $key . '><![CDATA[' . $val . ']]></' . $key . '>'; goto rnaok; Nc4w0: if (is_numeric($val)) { goto AYjNU; } goto Yn18J; Aiby_: S2K0N: goto w2_8o; VILer: AYjNU: goto qV8dU; w2_8o: UpcmV: goto scUvH; rnaok: goto S2K0N; goto VILer; scUvH: } goto j04VO; MV66t: $xml = '<xml>'; goto j1lja; j04VO: GBsQw: goto O7KKA; MB7YK: return $xml; goto RklF1; O7KKA: $xml .= '</xml>'; goto MB7YK; RklF1: } private function postXmlCurl($xml, $url, $useCert = false, $second = 30) { goto fqvGz; pXa6Q: curl_setopt($ch, CURLOPT_URL, $url); goto msrCE; i3en7: if (!$data) { goto vsVOB; } goto xl0MH; y4PN2: RUQPb: goto I86HP; msrCE: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE); goto wDKFR; gI2K7: curl_setopt($ch, CURLOPT_POSTFIELDS, $xml); goto rEky5; OvBrK: curl_setopt($ch, CURLOPT_SSLKEY, WxPayConfig::SSLKEY_PATH); goto y4PN2; wDKFR: curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 0); goto jKeKC; jKeKC: curl_setopt($ch, CURLOPT_HEADER, FALSE); goto sicEs; k0pOW: curl_setopt($ch, CURLOPT_SSLCERT, WxPayConfig::SSLCERT_PATH); goto ZMh1C; jH3tP: if (!($useCert == true)) { goto RUQPb; } goto Ysb6t; sicEs: curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); goto jH3tP; I86HP: curl_setopt($ch, CURLOPT_POST, TRUE); goto gI2K7; ZMh1C: curl_setopt($ch, CURLOPT_SSLKEYTYPE, 'PEM'); goto OvBrK; xl0MH: curl_close($ch); goto HEaMM; fqvGz: $ch = curl_init(); goto fAdK0; HEaMM: return $data; goto ncTqB; rEky5: $data = curl_exec($ch); goto i3en7; ncTqB: vsVOB: goto SxHZL; fAdK0: curl_setopt($ch, CURLOPT_TIMEOUT, $second); goto pXa6Q; Ysb6t: curl_setopt($ch, CURLOPT_SSLCERTTYPE, 'PEM'); goto k0pOW; SxHZL: } public function doMobileCheckOrder() { goto CLiIg; CLiIg: global $_GPC, $_W; goto zk_CU; JEboi: echo pdo_fetchcolumn('select status from ' . tablename($this->modulename . '_order') . " where id='{$orderid}'"); goto Q72fN; zk_CU: $orderid = $_GPC['orderid']; goto JEboi; Q72fN: } public function doMobileCheckTip() { goto ZtSSM; DXyUQ: echo pdo_fetchcolumn('select status from ' . tablename($this->modulename . '_tip') . " where id='{$orderid}'"); goto BXOrn; ZtSSM: global $_GPC, $_W; goto GMKE7; GMKE7: $orderid = $_GPC['orderid']; goto DXyUQ; BXOrn: } public function doWebGood() { goto o2HEF; sENqi: switch ($op) { case 'display': goto QIXvP; TpqSq: $pager = pagination($total, $pindex, $psize); goto ftWNW; iyqvb: if (!($_GPC['status'] != '')) { goto XfKFR; } goto od6JY; KbzqO: $total = col('select count(1) from ' . tb('good') . " where weid = '{$weid}' {$condition} "); goto TpqSq; Qu8Yz: jOA6m: goto iyqvb; ftWNW: goto Q2_rv; goto adFWp; od6JY: $condition .= " and status = '{$_GPC['status']}' "; goto tWPjJ; uI3Zc: $condition = ''; goto yGtuj; wCIXh: $list = getall('select * from ' . tb('good') . " where weid = '{$weid}' {$condition} order by sort desc,id {$limit}"); goto KbzqO; yGtuj: if (empty($_GPC['keyword'])) { goto jOA6m; } goto wBD8F; tWPjJ: XfKFR: goto ZFc2H; wBD8F: $condition .= " and (title like '%{$_GPC['keyword']}%' or sub_title like '%{$_GPC['keyword']}%') "; goto Qu8Yz; QIXvP: $pindex = max(intval($_GPC['page']), 1); goto ClKrD; ClKrD: $psize = 20; goto uI3Zc; ZFc2H: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto wCIXh; adFWp: case 'post': goto s9Q6s; fXpYz: insert('good', $data); goto fIklG; fIklG: message('操作成功', $this->createWebUrl('good', array("type" => empty($_GPC['type']) ? 0 : 1)), 'success'); goto ZW2Lv; FmmzF: $data = array("weid" => $weid, "title" => trim($_GPC['title']), "sub_title" => trim($_GPC['sub_title']), "label" => trim($_GPC['label']), "logo" => trim($_GPC['logo']), "price" => trim($_GPC['price']), "buy" => trim($_GPC['buy']), "postage" => trim($_GPC['postage']), "costprice" => trim($_GPC['costprice']), "sort" => intval($_GPC['sort']), "type" => intval($_GPC['type']), "status" => intval($_GPC['status']), "game" => serialize($_GPC['game'])); goto vmt_Z; ZW2Lv: goto Ryzlj; goto Fgp7R; Uo_Oq: message('操作成功', $this->createWebUrl('good', array("type" => empty($_GPC['type']) ? 0 : 1)), 'success'); goto odMu2; lqlL3: ztDL2: goto zFx00; mdCUn: update('good', $data, array("id" => $id)); goto Uo_Oq; s9Q6s: $id = $_GPC['id']; goto YVhgC; UDzxW: Y1ERn: goto bbZ8e; QMYw3: $item = get('select * from ' . tb('good') . " where id = '{$id}'"); goto b8Z0i; bbZ8e: if (!checksubmit()) { goto ztDL2; } goto FmmzF; zFx00: goto Q2_rv; goto tAT7I; vmt_Z: if ($item) { goto Q3S_6; } goto fXpYz; b8Z0i: $game = unserialize($item['game']); goto UDzxW; Fgp7R: Q3S_6: goto mdCUn; odMu2: Ryzlj: goto lqlL3; YVhgC: if (empty($id)) { goto Y1ERn; } goto QMYw3; tAT7I: case 'del': goto DP5X6; Zae2Q: $item = get('select * from ' . tb('good') . " where id = '{$id}'"); goto Qx4hX; DP5X6: $id = $_GPC['id']; goto Zae2Q; IJDPZ: if (del('good', array("id" => $id)) === false) { goto q4Aqi; } goto rG4Os; m1isl: Vqu_6: goto ssxfL; KSorp: sgGpD: goto IJDPZ; OLYmh: goto Vqu_6; goto xFz7o; xFz7o: q4Aqi: goto E14iV; ssxfL: goto Q2_rv; goto qdhm9; Qx4hX: if (!empty($item)) { goto sgGpD; } goto vA_oY; E14iV: message('操作失败', referer(), 'error'); goto m1isl; vA_oY: message('操作失败', $this->createWebUrl('good', array("type" => empty($_GPC['type']) ? 0 : 1)), 'error'); goto KSorp; rG4Os: message('操作成功', $this->createWebUrl('good', array("type" => empty($_GPC['type']) ? 0 : 1)), 'success'); goto OLYmh; qdhm9: case 'status': goto WtPCd; WtPCd: $id = $_GPC['id']; goto pSjYQ; pSjYQ: pdo_query('update ' . tablename($this->modulename . '_good') . " set status = !status where id='{$id}'"); goto IZ3RF; GjgyV: goto Q2_rv; goto oq1me; IZ3RF: die('1'); goto GjgyV; oq1me: case 'query': goto zXmzR; g4Qn8: $ds = getall('select id,title,sub_title from ' . tb('good') . " where weid = '{$weid}' {$con} "); goto ontc2; uEqJC: goto Q2_rv; goto uMQZS; zXmzR: $kwd = $_GPC['keywords']; goto H0EAH; MzEuD: if (empty($kwd)) { goto qax47; } goto qDm4E; u62Qi: exit; goto uEqJC; Bs6o1: qax47: goto g4Qn8; ontc2: include $this->template('query'); goto u62Qi; qDm4E: $con .= " and (title like '%{$kwd}%' or sub_title like '%{$kwd}%') "; goto Bs6o1; H0EAH: $con = ''; goto MzEuD; uMQZS: } goto BXzoo; sYj_e: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto w8K5f; BXzoo: eEy7S: goto SM0MV; GoOfz: include $this->template('good'); goto ctYrQ; SM0MV: Q2_rv: goto GoOfz; o2HEF: global $_W, $_GPC; goto sYj_e; w8K5f: $weid = $_W['uniacid']; goto sENqi; ctYrQ: } public function doWebMem() { goto ZN7LR; Ri6iu: include $this->template('mem'); goto S5zrs; h3i5X: $weid = $_W['uniacid']; goto Ou1qH; fW13h: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto h3i5X; F12Lu: WFGTp: goto Ri6iu; Ou1qH: switch ($op) { case 'display': goto l20M9; smFO2: $pindex = max(intval($_GPC['page']), 1); goto vkVEv; zaLBV: $lids = array_unique($lids); goto Hdd23; IC0ld: Vg13f: goto ZZldF; ZPlFj: foreach ($list as $k => $v) { goto yq89S; BmAwn: K9SkT: goto BCmFS; yq89S: if (!$v['lid']) { goto K9SkT; } goto nnMPA; BCmFS: GTuBj: goto vfIrL; nnMPA: $lids[] = $v['lid']; goto BmAwn; vfIrL: } goto IXvfh; T62OP: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_mem') . " where weid = '{$weid}' {$condition} order by id desc {$limit}"); goto yn3bG; IXvfh: fQ_z5: goto zaLBV; MZ8Cq: $condition .= " and (nickname like '%{$_GPC['keyword']}%' or id = '{$_GPC['keyword']}') "; goto JLMOq; Hdd23: if (empty($lids)) { goto Yowl0; } goto xrG0H; JLMOq: jDOZ8: goto Z8zqp; Sfc3m: $condition .= "and status = '{$_GPC['status']}'"; goto IC0ld; TFlUJ: qZNiP: goto NfT6r; crHl7: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto T62OP; rKLnb: Yowl0: goto TFlUJ; NfT6r: $total = pdo_fetchcolumn('select count(1) from ' . tablename($this->modulename . '_mem') . " where weid = '{$weid}' {$condition} "); goto V2Zpv; V2Zpv: $today = col('select count(1) from ' . tb('mem') . " where weid='{$_W['uniacid']}' and avatar != '' and to_days(from_unixtime(createtime)) = to_days(now()) "); goto C2h8e; UJI5E: goto WFGTp; goto eFQey; l20M9: $alllevels = getall('select id,title from ' . tb('level') . " where weid='{$weid}' order by level asc,id asc"); goto smFO2; TrVYJ: $pager = pagination($total, $pindex, $psize); goto UJI5E; vkVEv: $psize = 20; goto C5W3_; DR7dm: if (empty($_GPC['keyword'])) { goto jDOZ8; } goto MZ8Cq; Z8zqp: if (!($_GPC['status'] != '')) { goto Vg13f; } goto Sfc3m; ZZldF: $isSelfHost = isSelfHost(1); goto crHl7; yn3bG: if (empty($list)) { goto qZNiP; } goto ZPlFj; C5W3_: $condition = ' and avatar != \'\' '; goto DR7dm; C2h8e: $daytotal = col('select count(1) from ' . tb('mem') . " where weid='{$_W['uniacid']}' and avatar != '' "); goto TrVYJ; xrG0H: $levels = getall('select id,title,logo from ' . tb('level') . ' where id in (' . implode(',', $lids) . ')', 'id'); goto rKLnb; eFQey: case 'del': goto hWk2S; EUuHb: message('操作成功', $this->createWebUrl('mem'), 'success'); goto FDbTY; FDbTY: goto jw6QD; goto vOGbZ; vOGbZ: JaV49: goto YUjdj; hWk2S: $id = $_GPC['id']; goto by3DN; VQiCe: if (!empty($item)) { goto NfiTr; } goto MoWDP; by3DN: $item = pdo_fetch('select * from ' . tablename($this->modulename . '_mem') . " where id = '{$id}'"); goto VQiCe; MoWDP: message('操作失败', $this->createWebUrl('mem'), 'error'); goto im8IL; x7yft: goto WFGTp; goto N7eQb; C6E2J: jw6QD: goto x7yft; im8IL: NfiTr: goto q42vd; q42vd: if (pdo_delete($this->modulename . '_mem', array("id" => $id)) === false) { goto JaV49; } goto EUuHb; YUjdj: message('操作失败', referer(), 'error'); goto C6E2J; N7eQb: case 'status': goto MjobD; MjobD: $id = $_GPC['id']; goto HpKsk; XhMro: die('1'); goto pSzub; pSzub: goto WFGTp; goto j_2Za; HpKsk: pdo_query('update ' . tablename($this->modulename . '_mem') . " set status = !status where id='{$id}'"); goto XhMro; j_2Za: case 'level': goto K2TWu; elzcl: goto WFGTp; goto hnb26; K2TWu: $id = $_GPC['id']; goto AwYPU; Kl5H_: die('1'); goto elzcl; AwYPU: pdo_query('update ' . tablename($this->modulename . '_mem') . " set lid = '{$_GPC['lid']}' where id='{$id}'"); goto Kl5H_; hnb26: case 'recharge': goto cO1nA; q6s38: if (!empty($money)) { goto S4AoV; } goto vjPyR; cO1nA: $id = $_GPC['id']; goto OpM6e; O20lI: die('1'); goto P5ovy; bu_IF: S4AoV: goto vBuyU; PpdPj: $res = updateMemCredit($params); goto O20lI; OpM6e: $money = $_GPC['money']; goto q6s38; P5ovy: goto WFGTp; goto c6yvl; vBuyU: $params = array("mid" => $id, "credit" => $money, "remark" => "后台充值"); goto PpdPj; vjPyR: die('充值金额不能小于0'); goto bu_IF; c6yvl: case 'changeagent': goto U8AA0; U8AA0: $id = $_GPC['id']; goto mJ7Xk; mJ7Xk: pdo_query('update ' . tablename($this->modulename . '_mem') . " set isagent = !isagent where id='{$id}'"); goto uelgZ; uelgZ: die('1'); goto lf_bh; lf_bh: goto WFGTp; goto PV_nc; PV_nc: case 'credit': goto zZSut; tDQuQ: if (empty($_GPC['dateline'])) { goto mm1ld; } goto z71QM; rJqOW: $list = getall('select * from ' . tb('mcredit') . " where mid = '{$mid}' {$condition} order by createtime desc {$limit}"); goto cgKzN; zZSut: $mid = $_GPC['id']; goto TpUwn; cgKzN: $total = col('select count(1) from ' . tb('mcredit') . " where mid = '{$mid}' {$condition}"); goto VbIJV; PMfeC: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto tDQuQ; paVT_: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto rJqOW; y2YPV: $psize = 20; goto YCEZg; z71QM: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto XKazc; ARCeY: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto PMfeC; VbIJV: $pager = pagination($total, $pindex, $psize); goto I00kM; XKazc: mm1ld: goto paVT_; TpUwn: $pindex = max(intval($_GPC['page']), 1); goto y2YPV; I00kM: goto WFGTp; goto ho4ne; YCEZg: $condition = ''; goto ARCeY; ho4ne: case 'red': goto R1JiB; GfPaI: MEdo8: goto kDnmK; HDq04: $pager = pagination($total, $pindex, $psize); goto qUm88; fCRWC: $total = col('select count(1) from ' . tb('rcredit') . " where mid = '{$mid}' {$condition}"); goto HDq04; R1JiB: $mid = $_GPC['id']; goto YWpW_; kDnmK: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto gKSjY; rlLqu: $psize = 20; goto s2Mza; YWpW_: $pindex = max(intval($_GPC['page']), 1); goto rlLqu; s2Mza: $condition = ''; goto dA17R; dA17R: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto adYIp; gKSjY: $list = getall('select * from ' . tb('rcredit') . " where mid = '{$mid}' {$condition} order by createtime desc {$limit}"); goto fCRWC; adYIp: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto Y_21T; qUm88: goto WFGTp; goto d0sQu; Y_21T: if (empty($_GPC['dateline'])) { goto MEdo8; } goto yIAPw; yIAPw: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto GfPaI; d0sQu: case 'next': goto INb9w; Ya5XW: $tmpLevelAgentIds = array(); goto LktOK; d6yEC: $total = col('select count(1) from ' . tb('mem') . " where 1 {$condition} and avatar != ''"); goto IWDW1; eIfnS: $levelAgentids2 = $this->getLevelAgent($mid, 1); goto dvKpb; W2zwQ: TcGVv: goto mgChC; Onz80: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto eNi53; gqKcD: iT8c8: goto Bpac3; Ma7Dm: $psize = 20; goto pGDw7; YQW_Q: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto cakHl; LktOK: foreach ($levelAgentids2 as $kl => $vl) { $level3ids[] = $vl; fNxVL: } goto Obb7z; G1SeC: if ($level == 2) { goto NYP4O; } goto xw5Yo; H3gV5: $condition .= " and agentid = '{$mid}' "; goto CV8SF; aoI3v: foreach ($tmpLevelAgentIds as $k => $v) { goto CEGLR; yU8H8: YXOPi: goto UPn_K; CEGLR: if (empty($v)) { goto YXOPi; } goto Mfpa6; UPn_K: JLEtT: goto dZG5I; Mfpa6: $levelAgentids3[] = $v['id']; goto yU8H8; dZG5I: } goto acT1k; rCXH1: $condition .= ' and id = 0 '; goto dDPTd; tivIM: X7yes: goto ZWs4r; VWV7r: foreach ($levelAgentids2Total as $kl => $vl) { $level3idsTotal[] = $vl; Nfd_z: } goto UZIPf; nhWrC: $second = empty($levelAgentids2Total) ? 0 : count($levelAgentids2Total); goto K9jEm; KK7oO: n32fu: goto tivIM; uEakY: $condition .= ' and id = 0 '; goto QSR16; INb9w: $mid = $_GPC['id']; goto TRaLt; MB8wY: $condition .= ' and id in (' . implode(',', $levelAgentids2) . ') '; goto gB8Up; adXJ8: $levelAgentids3Total = array(); goto t7S9M; ucIYF: if (empty($list)) { goto ym8pJ; } goto v3gLs; DSMTw: $tmpLevelAgentIds = getall('select id from ' . tb('mem') . ' where agentid in (' . implode(',', $level3ids) . ')'); goto aoI3v; oKX1B: d1Db8: goto YQW_Q; fkT3Z: VHw8u: goto MB8wY; KnkPD: eK1MU: goto BMXwa; acT1k: nutIJ: goto ACTJq; idE_9: $tmpLevelAgentIdsTotal = getall('select id from ' . tb('mem') . ' where agentid in (' . implode(',', $level3idsTotal) . ')'); goto oRR2a; IWDW1: $first = col('select count(1) from ' . tb('mem') . " where agentid = '{$mid}' and avatar != ''"); goto cfslU; RslpO: goto mYxmt; goto cA3Eg; xd8cX: ym8pJ: goto d6yEC; tEcpl: $condition .= " and nickname like '%{$_GPC['keyword']}%' "; goto cZLK5; BMXwa: $level = intval($_GPC['level']); goto G1SeC; Bpac3: $recharges = getall('select mid,sum(commission) as tcommission,sum(commission_red) as tcommission_red from ' . tb('recharge') . ' where mid in (' . implode(',', $mids) . ") and status=1 and weid='{$weid}' group by mid", 'mid'); goto xd8cX; xw5Yo: if ($level == 1) { goto jXeSC; } goto H3gV5; TRaLt: $pindex = max(intval($_GPC['page']), 1); goto Ma7Dm; Haa8u: eitcZ: goto Evf67; eNi53: if (empty($_GPC['dateline'])) { goto eK1MU; } goto jKyq7; mgChC: if (!empty($levelAgentids3Total)) { goto WKUfe; } goto R2h6r; rowDI: jXeSC: goto eIfnS; CV8SF: goto d1Db8; goto JiNWS; dvKpb: if (!empty($levelAgentids2)) { goto VHw8u; } goto uEakY; pGDw7: $condition = ''; goto Eu4SB; dDPTd: goto n32fu; goto O7Ezq; ACTJq: if (!empty($levelAgentids3)) { goto FJhbH; } goto rCXH1; Evf67: $pager = pagination($total, $pindex, $psize); goto KZEfC; Obb7z: I5rU3: goto DSMTw; cakHl: $list = getall('select * from ' . tb('mem') . " where 1 {$condition} and avatar != '' order by createtime desc {$limit}"); goto ucIYF; l8YpE: if (!empty($levelAgentids2)) { goto Jsq_u; } goto mqEdD; AOpxy: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto Onz80; t7S9M: $tmpLevelAgentIdsTotal = array(); goto VWV7r; j5M0k: mYxmt: goto TYNwf; O4BPS: $condition1 .= ' and id in (' . implode(',', $levelAgentids3Total) . ') '; goto j5M0k; v3gLs: foreach ($list as $k => $v) { $mids[] = $v['id']; NVypc: } goto gqKcD; gB8Up: B6ZeP: goto oKX1B; Eu4SB: if (empty($_GPC['keyword'])) { goto sStrU; } goto tEcpl; IBAOf: $condition .= ' and id in (' . implode(',', $levelAgentids3) . ') '; goto KK7oO; KZEfC: goto WFGTp; goto M5Mc6; O7Ezq: FJhbH: goto IBAOf; wgd6A: $levelAgentids3 = array(); goto Ya5XW; K9jEm: if (empty($levelAgentids2Total)) { goto eitcZ; } goto adXJ8; jKyq7: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto KnkPD; VZ0wT: goto X7yes; goto IJ5e1; ZWs4r: goto d1Db8; goto rowDI; UZIPf: Orl5T: goto idE_9; cA3Eg: WKUfe: goto O4BPS; mqEdD: $condition .= ' and id = 0 '; goto VZ0wT; R2h6r: $condition1 .= ' and id = 0 '; goto RslpO; QSR16: goto B6ZeP; goto fkT3Z; TYNwf: $third = col('select count(1) from ' . tb('mem') . " where 1 {$condition1} and avatar != ''"); goto Haa8u; JiNWS: NYP4O: goto W_ReU; cfslU: $levelAgentids2Total = $this->getLevelAgent($mid, 1); goto nhWrC; oRR2a: foreach ($tmpLevelAgentIdsTotal as $k => $v) { goto tnSRA; gFZYB: lVxSZ: goto lkzbh; lkzbh: q1SdH: goto khVLC; snq95: $levelAgentids3Total[] = $v['id']; goto gFZYB; tnSRA: if (empty($v)) { goto lVxSZ; } goto snq95; khVLC: } goto W2zwQ; cZLK5: sStrU: goto AOpxy; IJ5e1: Jsq_u: goto wgd6A; W_ReU: $levelAgentids2 = $this->getLevelAgent($mid, 1); goto l8YpE; M5Mc6: case 'getmem': goto mo5aU; s_pnW: goto WFGTp; goto EoAgu; Zy9UQ: $condition = " and nickname like '%{$kwd}%' "; goto nj_Pv; cawlY: die(json_encode($mems)); goto s_pnW; mo5aU: $kwd = $_GPC['keyword']; goto Zy9UQ; nj_Pv: $mems = getall('select id,nickname from ' . tb('mem') . " where weid = '{$weid}' {$condition} "); goto cawlY; EoAgu: } goto pla92; pla92: lANC4: goto F12Lu; ZN7LR: global $_W, $_GPC; goto fW13h; S5zrs: } public function getLevelAgent($mid, $level = 0) { goto DFYPw; Jpp6H: pOgkP: goto h3W0R; Z_abC: if (!empty($mid)) { goto OG2oi; } goto uhei4; uhei4: return 0; goto ZIY2T; ulc9f: if (!($level >= 0)) { goto xicib; } goto z4s3b; adUq3: if (!($level == 0)) { goto AJypR; } goto CXvIL; ZIY2T: OG2oi: goto rptwR; FAq0I: foreach ($level1 as $k => $v) { $levelAgentids[] = $v['id']; Afzdk: } goto J37sa; z4s3b: if (empty($level1)) { goto LVPsM; } goto FAq0I; Clmga: AJypR: goto RVGBE; DFYPw: global $_W; goto Z_abC; R21Y9: return 0; goto N9exN; QGgi7: rFjKm: goto aFzxe; PtywD: return $levelAgentids2; goto QGgi7; RVGBE: if (!($level >= 1 && !empty($levelAgentids))) { goto WLtgt; } goto e3obV; c2Oq2: if (empty($mid)) { goto pOgkP; } goto skv_A; tOn59: xicib: goto R21Y9; skv_A: $con .= " and agentid = '{$mid}' "; goto Jpp6H; e3obV: $level2 = getall('select id from ' . tb('mem') . " where weid = '{$_W['uniacid']}' and avatar != '' and agentid in (" . implode(',', $levelAgentids) . ')'); goto d5p7w; h3W0R: $level1 = getall('select id from ' . tb('mem') . " where weid = '{$_W['uniacid']}' and avatar != '' {$con}"); goto ulc9f; c7c54: LVPsM: goto tOn59; CXvIL: return $levelAgentids; goto Clmga; d5p7w: if (empty($level2)) { goto rFjKm; } goto i6_2d; i6_2d: foreach ($level2 as $k => $v) { $levelAgentids2[] = $v['id']; pDYk4: } goto tPkae; J37sa: GiPrN: goto adUq3; tPkae: rCqnl: goto PtywD; rptwR: $con = ''; goto c2Oq2; aFzxe: WLtgt: goto c7c54; N9exN: } public function doWebRecharge() { goto y02HS; ze5Bl: $t = time() - 60 * 60; goto QFgKt; d7ksd: switch ($op) { case 'display': goto XV9Vc; CbyjB: OQ3md: goto lZgSv; PqH7W: $filename = '订单信息_' . date('YmdHis') . '.csv'; goto a176C; ZwN_F: P3bGt: goto hw3Bg; dInVs: $excel_title[] = '三级红包佣金'; goto h03Lp; Io02t: $yue = pdo_fetchcolumn('select sum(commission+commission2+commission3) from ' . tablename($this->modulename . '_recharge') . " where weid = '{$weid}' {$condition} "); goto N2u3G; hw3Bg: $mids = array_unique($mids); goto kWIN1; iaarW: $condition .= ' and ( mid in (select id from ' . tb('mem') . " where (nickname like '%{$_GPC['m_kwd']}%') and weid = '{$weid}') )"; goto GMO68; l7POD: $exceler->setContent($excel_data); goto Xbu2S; zapuO: $daymoney = col('select sum(price) from ' . tb('recharge') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status = 1"); goto MgQ2y; oYLs6: $money = pdo_fetchcolumn('select sum(price) from ' . tablename($this->modulename . '_recharge') . " where weid = '{$weid}' {$condition} "); goto Io02t; Q1aj9: $limit = ''; goto CbyjB; akbjd: $excel_data[] = array("总记录数:", $allsum); goto l7POD; dWvRV: goto Mdxtj; goto RluR2; hYgA1: $condition .= "and status = '{$_GPC['status']}'"; goto d48SB; BQMQX: $exceler->charset('UTF-8'); goto ws3k2; Wnt0b: $excel_title[] = '时间'; goto KXCmo; V50NK: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto ySMov; rOd_I: foreach ($list as $val) { goto gFWyR; gFWyR: $status = ''; goto K6bWv; tdreW: $allsum++; goto Yw0N1; XOylQ: $data[] = $val['transid']; goto ugcUx; rj6C9: $data[] = $val['commission_red3']; goto XOylQ; FOIOm: $data[] = $val['commission_red2']; goto Z7Fyn; jlrRT: acq7A: goto FyDAE; PRHqV: $data[] = $val['orderno']; goto BsogI; RTy4n: $data[] = $val['price']; goto Catfq; K6bWv: if ($val['status'] == 1) { goto acq7A; } goto iT0PB; Z7Fyn: $data[] = $val['commission3']; goto rj6C9; Yw0N1: HfISv: goto HcJam; R_zIx: $data = array(); goto PRHqV; xLorQ: jm6eZ: goto R_zIx; BsogI: $data[] = $mems[$val['mid']]['nickname']; goto RTy4n; roD2F: $data[] = $val['commission2']; goto FOIOm; FyDAE: $status = '已支付'; goto xLorQ; iT0PB: $status = '待支付'; goto VODyQ; Catfq: $data[] = $val['commission']; goto VJhUr; u9axb: $excel_data[] = $data; goto tdreW; VJhUr: $data[] = $val['commission_red']; goto roD2F; VODyQ: goto jm6eZ; goto jlrRT; ugcUx: $data[] = $status; goto wlR0k; wlR0k: $data[] = date('Y-m-d H:i:s', $val['createtime']); goto u9axb; HcJam: } goto KMfpa; L48J2: $today = col('select count(1) from ' . tb('recharge') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status = 1"); goto zapuO; gm2vP: if (!$_GPC['export']) { goto K6dsJ; } goto Ekpj2; kWIN1: $mems = getall('select id,nickname,avatar from ' . tb('mem') . ' where id in (' . implode(',', $mids) . ')', 'id'); goto gm2vP; SVEhR: $condition = ''; goto W9L3z; zQPfc: if (empty($list)) { goto Dkup6; } goto SJUOh; Gfm2G: $excel_title[] = '订单金额'; goto KffW0; VQ6DA: $excel_title[] = '会员名称'; goto Gfm2G; QrzAO: $psize = 20; goto SVEhR; ws3k2: $exceler->setFileName($filename); goto BQwKg; cYsiz: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto rwz98; h03Lp: $excel_title[] = '流水id'; goto wm546; C5nYl: if (empty($_GPC['m_kwd'])) { goto Q0PRG; } goto iaarW; BQwKg: $excel_title = array(); goto Te58e; KFlRl: $total = pdo_fetchcolumn('select count(1) from ' . tablename($this->modulename . '_recharge') . " where weid = '{$weid}' {$condition} "); goto oYLs6; EtcuK: include_once IA_ROOT . '/addons/junsion_winaward/excel.php'; goto PqH7W; rwz98: if (empty($_GPC['dateline'])) { goto at3SM; } goto psY_5; vdSXv: $allsum = 0; goto AoLgi; a176C: $exceler = new Jason_Excel_Export(); goto BQMQX; atrcE: $excel_title[] = '三级余额佣金'; goto dInVs; KMfpa: Aj1f1: goto akbjd; gk6KY: if (!($_GPC['status'] != '')) { goto YVYlT; } goto hYgA1; Xbu2S: $exceler->export(); goto TplvW; MgQ2y: $invite = col('select sum(credit) from ' . tb('invite_log') . " where weid='{$_W['uniacid']}' "); goto AM7e8; W9L3z: if (empty($_GPC['keyword'])) { goto gfB8s; } goto FG1GD; SJUOh: foreach ($list as $value) { $mids[] = $value['mid']; cGcwJ: } goto ZwN_F; AM7e8: $pager = pagination($total, $pindex, $psize); goto dWvRV; CW34P: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto cYsiz; wm546: $excel_title[] = '状态'; goto Wnt0b; psY_5: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto Du0d1; FG1GD: $condition .= " and orderno like '%{$_GPC['keyword']}%' "; goto GWevg; Te58e: $excel_title[] = '订单编号'; goto VQ6DA; QnRjm: $pindex = max(intval($_GPC['page']), 1); goto QrzAO; Ekpj2: set_time_limit(0); goto EtcuK; d48SB: YVYlT: goto CW34P; TplvW: exit; goto Ua3GI; Yfr1V: $excel_title[] = '二级红包佣金'; goto atrcE; O2p2M: $excel_title[] = '一级红包佣金'; goto cRbOJ; Du0d1: at3SM: goto V50NK; GWevg: gfB8s: goto C5nYl; ySMov: if (!$_GPC['export']) { goto OQ3md; } goto Q1aj9; AoLgi: $all = 0; goto MkyP8; GMO68: Q0PRG: goto gk6KY; sSa0t: Dkup6: goto KFlRl; N2u3G: $red = pdo_fetchcolumn('select sum(commission_red+commission_red2+commission_red3) from ' . tablename($this->modulename . '_recharge') . " where weid = '{$weid}' {$condition} "); goto L48J2; KXCmo: $exceler->setTitle($excel_title); goto vdSXv; cRbOJ: $excel_title[] = '二级余额佣金'; goto Yfr1V; MkyP8: $uns = 0; goto rOd_I; Ua3GI: K6dsJ: goto sSa0t; KffW0: $excel_title[] = '一级余额佣金'; goto O2p2M; XV9Vc: $cfg = $this->module['config']; goto QnRjm; lZgSv: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_recharge') . " where weid = '{$weid}' {$condition} order by id desc {$limit}"); goto zQPfc; RluR2: case 'del': goto aZTgO; p5ITi: if (pdo_delete($this->modulename . '_recharge', array("id" => $id)) === false) { goto Fc0H3; } goto zE3GF; go1_S: zjbXr: goto WhW5x; q1AY5: if (!empty($item)) { goto PApYs; } goto HWlvl; WhW5x: goto Mdxtj; goto ij2mv; ALjV0: PApYs: goto p5ITi; G5dXi: $item = pdo_fetch('select * from ' . tablename($this->modulename . '_recharge') . " where id = '{$id}'"); goto q1AY5; hXyyq: goto zjbXr; goto S03qQ; ihG1F: message('操作失败', referer(), 'error'); goto go1_S; HWlvl: message('操作失败', $this->createWebUrl('recharge'), 'error'); goto ALjV0; zE3GF: message('操作成功', $this->createWebUrl('recharge'), 'success'); goto hXyyq; S03qQ: Fc0H3: goto ihG1F; aZTgO: $id = $_GPC['id']; goto G5dXi; ij2mv: } goto DJllN; wRM2D: include $this->template('recharge'); goto n27q9; QFgKt: pdo_query('delete from ' . tablename($this->modulename . '_recharge') . " where status = 0 and createtime < '{$t}' "); goto d7ksd; DJllN: rmiyK: goto i4lSR; i4lSR: Mdxtj: goto wRM2D; Juiql: $weid = $_W['uniacid']; goto ze5Bl; AMX7f: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto Juiql; y02HS: global $_W, $_GPC; goto AMX7f; n27q9: } public function doWebOrder() { goto qLnG1; qLnG1: global $_W, $_GPC; goto yzfrg; U1LGf: pdo_query('delete from ' . tablename($this->modulename . '_order') . " where status = 0 and createtime < '{$t}' "); goto uBLP3; cj4K4: msjCF: goto DGiDG; b12d_: $weid = $_W['uniacid']; goto fnxFL; DGiDG: CziIC: goto WIZFa; WIZFa: include $this->template('order'); goto cehO_; uBLP3: switch ($op) { case 'display': goto THaa1; nbKE1: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto WRyj4; ys1Km: if (empty($list)) { goto O1yiZ; } goto lMJJd; JlZmo: $exceler->setFileName($filename); goto bdN9g; jYt8z: $exceler->charset('UTF-8'); goto JlZmo; PbMyC: $goods = getall('select id,title,logo from ' . tb('good') . ' where id in (' . implode(',', $gids) . ')', 'id'); goto M0zPb; HIudq: $all = 0; goto F24JT; aSZ1U: $psize = 20; goto n21wU; h2YVr: $condition .= " and orderno like '%{$_GPC['keyword']}%' "; goto MSLQl; jO9iI: $exceler = new Jason_Excel_Export(); goto jYt8z; tawjb: CJ1Mp: goto LYDCe; J7S_5: exit; goto WBbtC; UKqog: if (empty($_GPC['keyword'])) { goto XBMYj; } goto h2YVr; KXQaP: dpjKZ: goto Gn1u1; LYDCe: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_order') . " where weid = '{$weid}' {$condition} order by id desc {$limit}"); goto ys1Km; KLneM: a21Zm: goto nbKE1; WBbtC: Z5PDk: goto p9vv5; SdmfS: Libi1: goto QLCSj; Fn_UH: set_time_limit(0); goto snzQq; mwnTa: $money = pdo_fetchcolumn('select sum(price) from ' . tablename($this->modulename . '_order') . " where weid = '{$weid}' {$condition}"); goto Dcxqb; Gm4No: $condition .= ' and ( mid in (select id from ' . tb('mem') . " where (nickname like '%{$_GPC['m_kwd']}%') and weid = '{$weid}') )"; goto KXQaP; yS8sP: $exceler->export(); goto J7S_5; p9vv5: O1yiZ: goto YYCyh; Wjger: $condition .= "and status = '{$_GPC['status']}'"; goto KLneM; m8G3L: $excel_title[] = '时间'; goto ddP89; M1XOS: $excel_title[] = '订单编号'; goto EBzz7; n9B1y: $condition .= ' and ( gid in (select id from ' . tb('good') . " where (title like '%{$_GPC['g_kwd']}%' or sub_title like '%{$_GPC['g_kwd']}%') and weid = '{$weid}') )"; goto P2g1g; n21wU: $condition = ''; goto UKqog; FRDjQ: goto CziIC; goto m8g_R; THaa1: $pindex = max(intval($_GPC['page']), 1); goto aSZ1U; v70zl: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto JAbGU; EBzz7: $excel_title[] = '商品名称'; goto Fprqe; JvwMi: $excel_title[] = '流水id'; goto LHj01; R0FaZ: $excel_title[] = '备注'; goto m8G3L; Gn1u1: if (empty($_GPC['g_kwd'])) { goto aDqAA; } goto n9B1y; uylF6: FyhRm: goto Lomxp; Y7U1c: $gids = array_unique($gids); goto PbMyC; ddP89: $exceler->setTitle($excel_title); goto kdPvP; QLCSj: $mids = array_unique($mids); goto Qjymn; giC44: if (empty($_GPC['dateline'])) { goto H3ans; } goto v70zl; Ng1lH: $exceler->setContent($excel_data); goto yS8sP; M0zPb: if (!$_GPC['export']) { goto Z5PDk; } goto Fn_UH; lMJJd: foreach ($list as $value) { goto b6odB; b6odB: $mids[] = $value['mid']; goto YL2W_; ELN3O: kx0Nh: goto in6LI; YL2W_: $gids[] = $value['gid']; goto ELN3O; in6LI: } goto SdmfS; Fprqe: $excel_title[] = '会员名称'; goto Tll07; JAbGU: H3ans: goto EEf4Q; Qjymn: $mems = getall('select id,nickname,avatar from ' . tb('mem') . ' where id in (' . implode(',', $mids) . ')', 'id'); goto Y7U1c; WRyj4: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto giC44; Dcxqb: $today = col('select count(1) from ' . tb('order') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status >= 1"); goto r4NyR; bdN9g: $excel_title = array(); goto M1XOS; WrfkE: if (!$_GPC['export']) { goto CJ1Mp; } goto YIpB4; F24JT: $uns = 0; goto sraYR; YIpB4: $limit = ''; goto tawjb; EEf4Q: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto WrfkE; Tll07: $excel_title[] = '订单金额'; goto JvwMi; RuPSS: if (empty($_GPC['m_kwd'])) { goto dpjKZ; } goto Gm4No; NJgPS: if (!($_GPC['status'] != '')) { goto a21Zm; } goto Wjger; YYCyh: $total = pdo_fetchcolumn('select count(1) from ' . tablename($this->modulename . '_order') . " where weid = '{$weid}' {$condition}"); goto mwnTa; Lomxp: $excel_data[] = array("总记录数:", $allsum); goto Ng1lH; rD_wo: $filename = '闯关订单信息_' . date('YmdHis') . '.csv'; goto jO9iI; MSLQl: XBMYj: goto RuPSS; P2g1g: aDqAA: goto NJgPS; sraYR: foreach ($list as $val) { goto g9wty; g9wty: $status = ''; goto ziZlS; vAr8A: $data[] = date('Y-m-d H:i:s', $val['createtime']); goto OezKD; ixGCZ: PkThY: goto TbIjz; foTyQ: $status = '已完成'; goto MI2QU; qU9xb: $data[] = $val['price']; goto ApkMV; cAY_Y: LlCmT: goto Mfjro; ziZlS: if ($val['status'] == 1) { goto LlCmT; } goto oRP26; IoHuP: if ($val['status'] == -1) { goto if_x8; } goto WcviJ; QqWH9: $data[] = $val['orderno']; goto g32_G; Mfjro: $status = '已支付'; goto MINM9; Rfm9g: $status = '闯关失败'; goto D7wfm; ApkMV: $data[] = $val['transid']; goto dbSz3; TFnqL: $data[] = $mems[$val['mid']]['nickname']; goto qU9xb; D7wfm: aNtSj: goto YauEk; MI2QU: goto aNtSj; goto LYQjK; LYQjK: if_x8: goto Rfm9g; dbSz3: $data[] = $status; goto Vp0OK; TbIjz: $status = '待申请发货'; goto GnBld; GnBld: goto aNtSj; goto tbChv; oRP26: if ($val['status'] == 2) { goto PkThY; } goto c9rsp; nlisT: $allsum++; goto e_Nbl; OezKD: $excel_data[] = $data; goto nlisT; g32_G: $data[] = $goods[$val['gid']]['title']; goto TFnqL; Vp0OK: $data[] = $val['remark']; goto vAr8A; tbChv: GN1PC: goto foTyQ; cxix9: goto aNtSj; goto cAY_Y; YauEk: $data = array(); goto QqWH9; WcviJ: $status = '待支付'; goto cxix9; e_Nbl: Ttrhu: goto spCXM; c9rsp: if ($val['status'] == 3) { goto GN1PC; } goto IoHuP; MINM9: goto aNtSj; goto ixGCZ; spCXM: } goto uylF6; XWBHm: $pager = pagination($total, $pindex, $psize); goto FRDjQ; snzQq: include_once IA_ROOT . '/addons/junsion_shopreback/excel.php'; goto rD_wo; kdPvP: $allsum = 0; goto HIudq; LHj01: $excel_title[] = '状态'; goto R0FaZ; r4NyR: $daymoney = col('select sum(price) from ' . tb('order') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status >= 1"); goto XWBHm; m8g_R: case 'del': goto ftHnO; f0YTz: if (pdo_delete($this->modulename . '_order', array("id" => $id)) === false) { goto edSY2; } goto SqGps; ftHnO: $id = $_GPC['id']; goto ansGy; AkBNr: goto b1YX7; goto kZoYo; ansGy: $item = pdo_fetch('select * from ' . tablename($this->modulename . '_order') . " where id = '{$id}'"); goto Z7v7C; iLuWh: message('操作失败', $this->createWebUrl('order'), 'error'); goto ZCkuu; kZoYo: edSY2: goto ddilD; Z7v7C: if (!empty($item)) { goto mbMuw; } goto iLuWh; LU2i0: goto CziIC; goto zxxu6; NMPVu: b1YX7: goto LU2i0; ZCkuu: mbMuw: goto f0YTz; SqGps: message('操作成功', $this->createWebUrl('order'), 'success'); goto AkBNr; ddilD: message('操作失败', referer(), 'error'); goto NMPVu; zxxu6: } goto cj4K4; fnxFL: $t = time() - 60 * 60; goto U1LGf; yzfrg: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto b12d_; cehO_: } public function doWebRouge() { goto pULyl; D3FYx: $weid = $_W['uniacid']; goto etu1P; IlfwN: $express = getExpress(); goto hAPdz; etu1P: $t = time() - 60 * 60; goto CMztb; Syh26: nqKVK: goto k4QoG; DQVrT: tMcRv: goto Syh26; k4QoG: include $this->template('rouge'); goto i_XDH; pULyl: global $_W, $_GPC; goto dIevj; dIevj: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto D3FYx; hAPdz: switch ($op) { case 'display': goto lpE5r; vpk6t: $exceler->export(); goto yeIkk; Dy5c3: OG0nK: goto UkFaR; GVp0h: goto nqKVK; goto ISglB; OpcWA: if (empty($list)) { goto a7KxS; } goto A1nUd; rjcV4: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_rouge') . " where weid = '{$weid}' {$condition} order by id desc {$limit}"); goto OpcWA; rVhl6: $condition .= "and status = '{$_GPC['status']}'"; goto K222b; BETOT: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto rCOO3; sU36M: $mems = getall('select id,nickname,avatar from ' . tb('mem') . ' where id in (' . implode(',', $mids) . ')', 'id'); goto O5SMn; dzh72: LBsFR: goto uojBx; FuMS7: $excel_title[] = '快递单号'; goto YizvF; k_TMd: $excel_title[] = '地址'; goto e9y06; ijAVR: set_time_limit(0); goto GF00E; iXC6S: $filename = '口红订单信息_' . date('YmdHis') . '.csv'; goto EO996; uhjC5: $goods = getall('select id,title,logo from ' . tb('good') . ' where id in (' . implode(',', $gids) . ')', 'id'); goto UlbxF; Y4ny2: $excel_title[] = '微信号'; goto k_TMd; EO996: $exceler = new Jason_Excel_Export(); goto K12uh; y_9R4: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto hjrhJ; c11fu: if (empty($_GPC['dateline'])) { goto U2Q2c; } goto q2Y5X; NESjA: $excel_title[] = '商品数量'; goto wjVfu; DpdSr: $today = col('select count(1) from ' . tb('rouge') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status >= 1"); goto XVMsl; XUHSr: $excel_title[] = '状态'; goto nF4ey; yeIkk: exit; goto Wov5r; nYpns: $excel_title[] = '订单类型'; goto uBw2z; Dh9yp: U2Q2c: goto BETOT; UkFaR: if (empty($_GPC['m_kwd'])) { goto LBsFR; } goto Cv7d0; NVGzE: $excel_title = array(); goto LUETQ; JC42G: $excel_title[] = '商品名称'; goto NESjA; lGafh: $excel_data[] = array("总记录数:", $allsum); goto PFopD; AK1WN: $all = 0; goto H8Sh4; YizvF: $excel_title[] = '时间'; goto DQ4zu; e165N: $mids = array_unique($mids); goto sU36M; Wb_Ng: $psize = 20; goto Z0bGw; Wov5r: Ec4xu: goto awNzt; K222b: ZkEYW: goto y_9R4; GF00E: include_once IA_ROOT . '/addons/junsion_winaward/excel.php'; goto iXC6S; q2Y5X: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto Dh9yp; LojNc: fTVlA: goto e165N; e9y06: $excel_title[] = '快递公司'; goto FuMS7; PFopD: $exceler->setContent($excel_data); goto vpk6t; iUZ8c: foreach ($list as $val) { goto G4tNI; yJcDi: $data[] = empty($val['wx_no']) ? '实体订单' : '虚拟订单'; goto NbHRL; DVNJr: $excel_data[] = $data; goto qRgpd; UJbuo: $data[] = $val['status'] > 1 ? $express[$val['express']] : ''; goto cZu6d; vX73O: if ($val['status'] == 2) { goto m6XQQ; } goto A87Ik; NbHRL: $data[] = $mems[$val['mid']]['nickname']; goto xgUcr; WfNgP: $data[] = $val['wx_no']; goto UJbuo; ogo_A: $data[] = $val['num']; goto a4FkU; cUyH6: $data[] = $val['orderno']; goto yJcDi; xgUcr: $data[] = $goods[$val['gid']]['title']; goto ogo_A; G4tNI: $status = ''; goto iCta7; uwJtR: m6XQQ: goto xl5Tc; cSxbV: $data[] = $status; goto vI3LY; cZu6d: $data[] = $val['expressno']; goto KAqik; qRgpd: $allsum++; goto tuqMU; IkvDe: $data[] = $val['uname']; goto RU9Qf; tuqMU: AuBYu: goto Qluq_; WQI66: goto WKJ01; goto uwJtR; Dbv2V: $data[] = $val['addr']; goto WfNgP; A87Ik: $status = '待支付'; goto vDuH0; IPoPC: WKJ01: goto CelBn; vI3LY: $data[] = $val['transid']; goto IkvDe; KAqik: $data[] = date('Y-m-d H:i:s', $val['createtime']); goto DVNJr; iCta7: if ($val['status'] == 1) { goto ZaJKs; } goto vX73O; a4FkU: $data[] = $val['price']; goto cSxbV; RU9Qf: $data[] = $val['mobile']; goto Dbv2V; xl5Tc: $status = '已发货'; goto IPoPC; wP4M6: ZaJKs: goto jWFp9; jWFp9: $status = '已支付'; goto WQI66; vDuH0: goto WKJ01; goto wP4M6; CelBn: $data = array(); goto cUyH6; Qluq_: } goto PNHZy; w2K6c: $exceler->setFileName($filename); goto NVGzE; Z0bGw: $condition = ''; goto tsmXZ; Jmvyb: $excel_title[] = '联系电话'; goto Y4ny2; H8Sh4: $uns = 0; goto iUZ8c; LRssN: $excel_title[] = '联系人'; goto Jmvyb; O5SMn: $gids = array_unique($gids); goto uhjC5; PNHZy: Q1031: goto lGafh; tOMGd: $allsum = 0; goto AK1WN; JBqEB: ROWmF: goto rjcV4; XVMsl: $daymoney = col('select sum(price) from ' . tb('rouge') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status >= 1"); goto vlsYM; xauSQ: $limit = ''; goto JBqEB; FiUrR: if (!($_GPC['status'] != '')) { goto ZkEYW; } goto rVhl6; K12uh: $exceler->charset('UTF-8'); goto w2K6c; rCOO3: if (!$_GPC['export']) { goto ROWmF; } goto xauSQ; Ypra4: $condition .= ' and ( gid in (select id from ' . tb('good') . " where (title like '%{$_GPC['g_kwd']}%' or sub_title like '%{$_GPC['g_kwd']}%') and weid = '{$weid}') )"; goto rBVpg; LUETQ: $excel_title[] = '订单编号'; goto nYpns; Cv7d0: $condition .= ' and ( mid in (select id from ' . tb('mem') . " where (nickname like '%{$_GPC['m_kwd']}%') and weid = '{$weid}') )"; goto dzh72; wjVfu: $excel_title[] = '订单金额'; goto XUHSr; weN4h: $money = pdo_fetchcolumn('select sum(price) from ' . tablename($this->modulename . '_rouge') . " where weid = '{$weid}' {$condition} "); goto DpdSr; A1nUd: foreach ($list as $value) { goto tavvd; dBHqJ: e3YHt: goto EbNFx; tavvd: $mids[] = $value['mid']; goto zta7m; zta7m: $gids[] = $value['gid']; goto dBHqJ; EbNFx: } goto LojNc; nF4ey: $excel_title[] = '流水id'; goto LRssN; IVxif: $total = pdo_fetchcolumn('select count(1) from ' . tablename($this->modulename . '_rouge') . " where weid = '{$weid}' {$condition}"); goto weN4h; uBw2z: $excel_title[] = '会员名称'; goto JC42G; lpE5r: $pindex = max(intval($_GPC['page']), 1); goto Wb_Ng; vvcyT: $condition .= " and orderno like '%{$_GPC['keyword']}%' "; goto Dy5c3; rBVpg: Os_Kv: goto FiUrR; awNzt: a7KxS: goto IVxif; vlsYM: $pager = pagination($total, $pindex, $psize); goto GVp0h; DQ4zu: $exceler->setTitle($excel_title); goto tOMGd; hjrhJ: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto c11fu; tsmXZ: if (empty($_GPC['keyword'])) { goto OG0nK; } goto vvcyT; UlbxF: if (!$_GPC['export']) { goto Ec4xu; } goto ijAVR; uojBx: if (empty($_GPC['g_kwd'])) { goto Os_Kv; } goto Ypra4; ISglB: case 'send': goto ogDPu; XsBzQ: if (!empty($selExpressno)) { goto JLx2V; } goto bWOFd; VjFNl: die('1'); goto ema46; oULQI: $selExpressno = $_GPC['expressno']; goto XsBzQ; FLX1A: pdo_query('update ' . tablename($this->modulename . '_rouge') . " set status = 2,`express`='{$selExpress}',expressno='{$selExpressno}' where id='{$id}'"); goto VjFNl; hcRCP: bMbA7: goto KlX5Q; Z9bCE: $item = get('select * from ' . tb('rouge') . " where id = '{$id}'"); goto ISpNd; ISpNd: if (!empty($item)) { goto bMbA7; } goto Nek_W; ema46: goto nqKVK; goto nEsPX; Nek_W: die('订单不存在或已删除'); goto hcRCP; KlX5Q: if (!($item['status'] != 1)) { goto eTb5Z; } goto XcPG2; h3ZCe: JLx2V: goto FLX1A; bWOFd: die('请输入快递单号'); goto h3ZCe; atWP2: $selExpress = $_GPC['express']; goto oULQI; XcPG2: die('订单状态不正确，无法发货'); goto yEERC; ogDPu: $id = $_GPC['id']; goto Z9bCE; yEERC: eTb5Z: goto atWP2; nEsPX: case 'del': goto qsd1m; ytyrh: goto GM_tX; goto uF26N; Pdnej: HMz0p: goto V65Fw; ahByZ: message('操作成功', $this->createWebUrl('rouge'), 'success'); goto ytyrh; uF26N: NTRj5: goto fJD5b; L7KqM: GM_tX: goto iPa0f; V65Fw: if (pdo_delete($this->modulename . '_rouge', array("id" => $id)) === false) { goto NTRj5; } goto ahByZ; ijCgX: message('操作失败', $this->createWebUrl('rouge'), 'error'); goto Pdnej; iPa0f: goto nqKVK; goto ukBpU; qsd1m: $id = $_GPC['id']; goto k_M9N; fJD5b: message('操作失败', referer(), 'error'); goto L7KqM; u318T: if (!empty($item)) { goto HMz0p; } goto ijCgX; k_M9N: $item = pdo_fetch('select * from ' . tablename($this->modulename . '_rouge') . " where id = '{$id}'"); goto u318T; ukBpU: } goto DQVrT; CMztb: pdo_query('delete from ' . tablename($this->modulename . '_rouge') . " where status = 0 and createtime < '{$t}' "); goto IlfwN; i_XDH: } public function doWebLog() { goto iTc74; Uc0Kr: $weid = $_W['uniacid']; goto WPZBd; WPZBd: switch ($op) { case 'display': goto ULJbU; NgTu2: $mems = getall('select id,nickname,avatar from ' . tb('mem') . ' where id in (' . implode(',', $mids) . ')', 'id'); goto T4fXC; W_VpE: if (empty($list)) { goto w36A3; } goto d2nKX; nfqfH: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto qBfWn; DQznv: $condition .= ' and ( mid in (select id from ' . tb('mem') . " where (nickname like '%{$_GPC['m_kwd']}%') and weid = '{$weid}') )"; goto pDyeY; JfY4g: $psize = 20; goto j_QwM; kqD9h: goto IDUIg; goto LgfSa; NQcHt: $condition .= "and status = '{$_GPC['status']}'"; goto i014T; XbeDA: $total = pdo_fetchcolumn('select count(1) from ' . tablename($this->modulename . '_log') . " where weid = '{$weid}' "); goto mN_RF; pDyeY: QQl7k: goto bDEml; MGax1: if (!($_GPC['status'] != '')) { goto SlmFO; } goto NQcHt; fQMA5: BdEnd: goto RFoGK; t7hDi: if (empty($_GPC['m_kwd'])) { goto QQl7k; } goto DQznv; i014T: SlmFO: goto ggtjB; LKYt_: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto m7vPW; d2nKX: foreach ($list as $value) { goto bprqi; bprqi: $mids[] = $value['mid']; goto D0Kku; uacRh: huYhD: goto IGu6G; oKhEf: $oids[] = $value['oid']; goto uacRh; D0Kku: $gids[] = $value['gid']; goto oKhEf; IGu6G: } goto fQMA5; zywKH: if (empty($_GPC['keyword'])) { goto DyvAm; } goto FCHN2; nttPk: $goods = getall('select id,title,logo from ' . tb('good') . ' where id in (' . implode(',', $gids) . ')', 'id'); goto VgQIb; ds4gq: fhq_z: goto zywKH; jvSgg: if (empty($_GPC['dateline'])) { goto lDWYU; } goto LKYt_; mN_RF: $pager = pagination($total, $pindex, $psize); goto kqD9h; qBfWn: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_log') . " where weid = '{$weid}' {$condition} order by id desc {$limit}"); goto W_VpE; VgQIb: $oids = array_unique($oids); goto ctzeO; ggtjB: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto AIm3n; EML2r: DyvAm: goto MGax1; Y2kD7: w36A3: goto XbeDA; pWA02: $condition .= ' and ( gid in (select id from ' . tb('good') . " where (title like '%{$_GPC['g_kwd']}%' or sub_title like '%{$_GPC['g_kwd']}%') and weid = '{$weid}') )"; goto ds4gq; ctzeO: $orders = getall('select id,orderno from ' . tb('order') . ' where id in (' . implode(',', $oids) . ')', 'id'); goto Y2kD7; T4fXC: $gids = array_unique($gids); goto nttPk; ULJbU: $pindex = max(intval($_GPC['page']), 1); goto JfY4g; j_QwM: $condition = ''; goto t7hDi; bDEml: if (empty($_GPC['g_kwd'])) { goto fhq_z; } goto pWA02; AIm3n: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto jvSgg; RFoGK: $mids = array_unique($mids); goto NgTu2; m7vPW: lDWYU: goto nfqfH; FCHN2: $condition .= ' and ( oid in (select id from ' . tb('order') . " where (orderno like '%{$_GPC['keyword']}%') and weid = '{$weid}') )"; goto EML2r; LgfSa: case 'del': goto R0X_k; lLm0J: goto BoMwN; goto vzhcv; MtfnZ: BoMwN: goto cFfmS; vRGgx: message('操作失败', $this->createWebUrl('log'), 'error'); goto RJtUO; R0X_k: $id = $_GPC['id']; goto bcgmC; flZU2: if (pdo_delete($this->modulename . '_log', array("id" => $id)) === false) { goto fqKmY; } goto rUZol; rUZol: message('操作成功', $this->createWebUrl('log'), 'success'); goto lLm0J; bcgmC: $item = pdo_fetch('select * from ' . tablename($this->modulename . '_log') . " where id = '{$id}'"); goto Row_x; vzhcv: fqKmY: goto SKYRP; cFfmS: goto IDUIg; goto BIVC_; SKYRP: message('操作失败', referer(), 'error'); goto MtfnZ; Row_x: if (!empty($item)) { goto a1TpG; } goto vRGgx; RJtUO: a1TpG: goto flZU2; BIVC_: } goto kOZub; u3cwY: IDUIg: goto bkPFj; kOZub: Jigcz: goto u3cwY; iTc74: global $_W, $_GPC; goto o9dht; o9dht: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto Uc0Kr; bkPFj: include $this->template('log'); goto uKGBN; uKGBN: } public function doWebWith() { goto Uj73f; uTq9M: $params['openid'] = $openid; goto vzNeT; vcQfV: L6hSC: goto Ws36k; zQyuK: $allsum = 0; goto zdX3z; CN8Xz: oKBdh: goto bkvi6; Qv773: U2p7n: goto HgJBt; C1DCZ: if (!empty($item)) { goto L6hSC; } goto ZTj6k; hJkPI: if ($_GPC['op'] == 'send') { goto pUKFx; } goto QoFm5; WuOnq: $excel_title = array(); goto Xl7xF; TZsk2: $all = getall('select status,price,wrate from ' . tb('with') . " where weid='{$_W['uniacid']}' {$con}"); goto KeB2y; m_2gI: foreach ($list as $value) { $mids[] = $value['mid']; wPz0v: } goto j5mxA; IpnWe: $exceler->setContent($excel_data); goto ea3Gc; j5mxA: HlEmr: goto IqOBz; ZTj6k: message('操作失败', $this->createWebUrl('with'), 'error'); goto vcQfV; ggbmD: $excel_title[] = '时间'; goto H4ZUE; LU1Wz: if (!$_GPC['export']) { goto HWbqW; } goto us2HV; Y24ej: dUjXC: goto puPuH; af75x: $limit = ''; goto nguoV; YAzj4: $all_num = 0; goto YuoiX; sE3mk: TdRs5: goto WHRmu; nF7PO: include $this->template('with'); goto CTc2Q; H4ZUE: $exceler->setTitle($excel_title); goto zQyuK; SpI8J: if (empty($_GPC['keyword'])) { goto oKBdh; } goto yRTTh; SwXYc: $exceler->setFileName($filename); goto WuOnq; bkvi6: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto eV33T; qqtBK: MSG('发放完成！', $this->createWebUrl('with')); goto Yakhu; j41Da: if (empty($list)) { goto WirT1; } goto m_2gI; yRTTh: $con .= ' and ( mid in (select id from ' . tb('mem') . " where nickname like '%{$_GPC['keyword']}%' and weid = '{$_W['uniacid']}') )"; goto CN8Xz; A71pR: if ($res['code'] == 1) { goto TdRs5; } goto wdre_; YmLy4: foreach ($list as &$v) { goto NlOR7; tQvoA: $v['avatar'] = $mems[$v['mid']]['avatar']; goto gxvkb; NlOR7: $v['nickname'] = $mems[$v['mid']]['nickname']; goto tQvoA; Syavm: lzV2d: goto cIcK_; gxvkb: $v['qr'] = $mems[$v['mid']]['qr']; goto Syavm; cIcK_: } goto dMf50; nguoV: SLz25: goto iUHKZ; Ws36k: if (del('with', array("id" => $id)) === false) { goto mqKeV; } goto CWmTe; aqs5X: MSG('发放失败！原因：' . $res['msg']); goto OAY2W; YJeww: if (!$_GPC['export']) { goto SLz25; } goto af75x; mrttC: $excel_title[] = '金额'; goto oDCn2; HgJBt: goto dUjXC; goto CLE5p; dMf50: RGCLj: goto oD1ZC; cdjK1: $id = $_GPC['id']; goto AG_kF; g1F8B: foreach ($today as $val) { goto oIA7q; oIA7q: if ($val['status']) { goto Uws9C; } goto Dslpq; g8qxI: Uws9C: goto uzCHG; B7GOP: BxLmr: goto Xzqaj; Dslpq: $today_num += $val['price']; goto yEw7z; yEw7z: goto BxLmr; goto g8qxI; Xzqaj: rOZ3u: goto Wcunt; uzCHG: $today_money += $val['price']; goto B7GOP; Wcunt: } goto BLsTw; oDCn2: $excel_title[] = '手续费'; goto NNUe9; XLc7C: HWbqW: goto jZQdm; vgygx: $today_money = 0; goto YAzj4; fWVQg: $withall = getall('select id,price,mid,wrate from ' . tb('with') . " where weid='{$_W['uniacid']}' and status=0 "); goto ZkT_b; c7_dh: $pager = pagination($total, $pindex, $psize); goto VI9NU; IqOBz: $mids = array_unique($mids); goto CTjA7; DUUV1: $params = array("price" => $with['price']); goto EbGy2; DvBGp: $excel_data[] = array("总记录数:", $allsum); goto IpnWe; KSKzF: I_sRT: goto qqtBK; OAY2W: goto ROZCU; goto sE3mk; us2HV: set_time_limit(0); goto gxzHF; Xje3Z: $total = col('select count(1) from ' . tb('with') . " where weid='{$_W['uniacid']}' {$con}"); goto c7_dh; EbGy2: $openid = col('select openid from ' . tb('mem') . " where id='{$with['mid']}'"); goto uTq9M; L4rO7: goto U2p7n; goto I0zEH; mRiVP: $uns = 0; goto L5Szf; KeB2y: $today_num = 0; goto vgygx; wdre_: update('with', array("status" => 0, "transid" => $res['msg']), array("id" => $wid)); goto aqs5X; JKHIj: mqKeV: goto mZZEK; gxzHF: include_once IA_ROOT . '/addons/junsion_shopreback/excel.php'; goto F3W3k; wOahX: $con = ''; goto SpI8J; ea3Gc: $exceler->export(); goto FCwL7; QoFm5: if ($_GPC['op'] == 'sendall') { goto SFJNg; } goto Hftwo; iU88_: $exceler = new Jason_Excel_Export(); goto c4KQT; Hftwo: if ($_GPC['op'] == 'del') { goto Ygs32; } goto Ic9bs; Xl7xF: $excel_title[] = '会员'; goto mrttC; BFc5I: if ($cfg['commission']['wtype'] == 0) { goto Vls1H; } goto E8fVP; zdX3z: $all = 0; goto mRiVP; K_kcl: foreach ($all as $val) { goto M2hvg; hJn4l: $all_num += $val['price']; goto Z3pR3; oaQ7q: GlOag: goto l8LPq; Avl7H: YNt0b: goto wKqqK; Cl7nA: B6L0p: goto FVRL4; Z3pR3: goto GlOag; goto Cl7nA; l8LPq: $all_rate += $val['wrate']; goto Avl7H; M2hvg: if ($val['status']) { goto B6L0p; } goto hJn4l; FVRL4: $all_money += $val['price']; goto oaQ7q; wKqqK: } goto viVyC; NNUe9: $excel_title[] = '流水id'; goto G0uWh; YuoiX: $all_money = 0; goto g1F8B; BLsTw: WOYQy: goto K_kcl; zDZ7D: $psize = 20; goto wOahX; viVyC: f6mOR: goto nF7PO; CLE5p: SFJNg: goto fWVQg; E8fVP: update('with', array("status" => 1, "transid" => "手动打款"), array("id" => $wid)); goto imJtL; bJTxu: pUKFx: goto hbMsS; L5Szf: foreach ($list as $val) { goto wxELn; Q1p41: B1x3y: goto WBaGn; cyGSC: goto ZFX11; goto Q1p41; NU6wQ: $data[] = $status; goto yigjf; QKPN5: $data[] = $val['transid']; goto NU6wQ; NgOnS: bruhi: goto lVem0; Awe1l: $data[] = $val['wrate']; goto QKPN5; Jy92b: $status = '待审核'; goto cyGSC; QNRP6: ZFX11: goto VNtKF; xlQ9V: $excel_data[] = $data; goto egw_n; NaqeO: $data[] = $val['price']; goto Awe1l; wxELn: $status = ''; goto xgZdE; xgZdE: if ($val['status'] == 1) { goto B1x3y; } goto Jy92b; VNtKF: $data = array(); goto jWEM8; egw_n: $allsum++; goto NgOnS; jWEM8: $data[] = $val['nickname']; goto NaqeO; yigjf: $data[] = date('Y-m-d H:i', $val['createtime']); goto xlQ9V; WBaGn: $status = '已发放'; goto QNRP6; lVem0: } goto GJ7Ii; VavWQ: YsTa4: goto Y24ej; Ic9bs: goto dUjXC; goto bJTxu; xsrll: Ygs32: goto cdjK1; hbMsS: $wid = intval($_GPC['id']); goto Ip1Es; jZQdm: WirT1: goto Xje3Z; wyHL3: xgQrK: goto BFc5I; mZZEK: message('操作失败', referer(), 'error'); goto VavWQ; o7XRv: if (!$with['status']) { goto xgQrK; } goto yzJbY; iUHKZ: $list = getall('select * from ' . tb('with') . " where weid='{$_W['uniacid']}' {$con} order by status,createtime desc {$limit} "); goto j41Da; Ip1Es: $with = get('select * from ' . tb('with') . " where id='{$wid}'"); goto o7XRv; QaUdu: MSG('发放成功！', 'referer'); goto krtPy; I0zEH: Vls1H: goto DUUV1; Yakhu: goto dUjXC; goto xsrll; Cwgud: $limit = ' limit ' . ($pindex - 1) * $psize . ',' . $psize; goto YJeww; mJ9Sy: foreach ($withall as $with) { goto aqkED; fD3Fc: if ($res['code'] == 1) { goto Oa0px; } goto msrOv; OytP1: update('with', array("status" => 1, "transid" => $res['msg']), array("id" => $with['id'])); goto ur1q2; Jy2zS: goto vJZyV; goto GedOu; YpVNs: goto SIv5u; goto E3vaD; msrOv: update('with', array("status" => 0, "transid" => $res['msg']), array("id" => $with['id'])); goto YpVNs; VNZV0: vJZyV: goto jO0oq; jO0oq: fu2FW: goto dN5oq; KmM_V: $params['openid'] = $openid; goto WHCan; aqkED: if ($cfg['commission']['wtype'] == 0) { goto eTAe7; } goto zKbme; E3vaD: Oa0px: goto OytP1; ls6d7: $openid = col('select openid from ' . tb('mem') . " where id='{$with['mid']}'"); goto KmM_V; GedOu: eTAe7: goto MMUKA; ur1q2: SIv5u: goto VNZV0; zKbme: update('with', array("status" => 1, "transid" => "手动打款"), array("id" => $with['id'])); goto Jy2zS; MMUKA: $params = array("price" => $with['price']); goto ls6d7; WHCan: $res = $this->sendRedPacket($params); goto fD3Fc; dN5oq: } goto KSKzF; vzNeT: $res = $this->sendRedPacket($params); goto A71pR; G0uWh: $excel_title[] = '状态'; goto ggbmD; oD1ZC: unset($v); goto LU1Wz; krtPy: ROZCU: goto Qv773; c4KQT: $exceler->charset('UTF-8'); goto SwXYc; yzJbY: MSG('该订单已提现！'); goto wyHL3; CTjA7: $mems = getall('select id,nickname,avatar,qr from ' . tb('mem') . ' where id in (' . implode(',', $mids) . ')', 'id'); goto YmLy4; Uj73f: global $_W, $_GPC; goto WvHFl; ZkT_b: set_time_limit(0); goto mJ9Sy; jkQoB: Qa4eu: goto Cwgud; qW0km: goto YsTa4; goto JKHIj; GJ7Ii: bi_wO: goto DvBGp; VI9NU: $today = getall('select status,price from ' . tb('with') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) {$con}"); goto TZsk2; WHRmu: update('with', array("status" => 1, "transid" => $res['msg']), array("id" => $wid)); goto QaUdu; eV33T: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto Ywyw0; CWmTe: message('操作成功', $this->createWebUrl('with'), 'success'); goto qW0km; puPuH: $pindex = max(intval($_GPC['page']), 1); goto zDZ7D; imJtL: MSG('发放成功！', 'referer'); goto L4rO7; bhBU3: $con .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto jkQoB; Ywyw0: if (empty($_GPC['dateline'])) { goto Qa4eu; } goto bhBU3; WvHFl: $cfg = $this->module['config']; goto hJkPI; AG_kF: $item = 'select * from ' . tb('with') . " where id = '{$id}'"; goto C1DCZ; FCwL7: exit; goto XLc7C; F3W3k: $filename = '提现信息_' . date('YmdHis') . '.csv'; goto iU88_; CTc2Q: } public function doWebLevel() { goto Hg2p4; W3uV_: include $this->template('level'); goto u0d3i; OsXf4: SLXbp: goto P0Tz0; lRGeg: $weid = $_W['uniacid']; goto DIh1Q; DIh1Q: switch ($op) { case 'display': goto LTN6e; ImQzl: $total = col('select count(1) from ' . tb('level') . " where weid = '{$weid}' {$condition} "); goto qfq2v; cF2cT: $condition .= " and status = '{$_GPC['status']}' "; goto XDwFJ; mBSQv: $condition .= " and title like '%{$_GPC['keyword']}%' "; goto lgYgU; Kxbhx: if (empty($_GPC['keyword'])) { goto YsN7x; } goto mBSQv; lgYgU: YsN7x: goto r3Gh5; XV4nH: goto g_3_S; goto pqPo0; XDwFJ: BaEJB: goto WFn9c; gt7sI: $list = getall('select * from ' . tb('level') . " where weid = '{$weid}' {$condition} order by id {$limit}"); goto ImQzl; LTN6e: $pindex = max(intval($_GPC['page']), 1); goto KszZS; qfq2v: $pager = pagination($total, $pindex, $psize); goto XV4nH; W1vXG: $condition = ''; goto Kxbhx; WFn9c: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto gt7sI; KszZS: $psize = 20; goto W1vXG; r3Gh5: if (!($_GPC['status'] != '')) { goto BaEJB; } goto cF2cT; pqPo0: case 'post': goto XsE0M; q4EHA: $data = array("weid" => $weid, "title" => trim($_GPC['title']), "logo" => trim($_GPC['logo']), "price" => trim($_GPC['price']), "level" => intval($_GPC['level']), "commission" => serialize($_GPC['commission'])); goto Lb58z; ep89k: message('操作成功', $this->createWebUrl('level'), 'success'); goto xr6Q9; gicgW: update('level', $data, array("id" => $id)); goto ep89k; QTY5g: V25iR: goto q4EHA; Lb58z: if ($item) { goto GObcg; } goto tKx61; VpcBV: goto UD5jf; goto wqTyV; B7hiY: goto g_3_S; goto a5X4P; ixK8p: if (!checksubmit()) { goto vvl4F; } goto U4lGQ; yuHJx: $item = get('select * from ' . tb('level') . " where id = '{$id}'"); goto eJKyY; EfMsK: L_HAV: goto ixK8p; XsE0M: $id = $_GPC['id']; goto u_EqT; Sm9CX: message('操作成功', $this->createWebUrl('level'), 'success'); goto VpcBV; KNMaX: if (!(!empty($is_save) && $id != $is_save['id'])) { goto V25iR; } goto eRrmg; tKx61: insert('level', $data); goto Sm9CX; U4lGQ: $is_save = get('select id from ' . tb('level') . " where weid='{$weid}' and level = '{$_GPC['level']}'"); goto KNMaX; eRrmg: message('该级别的等级已经存在，请重新选择等级级别', referer(), 'error'); goto QTY5g; wqTyV: GObcg: goto gicgW; f4OlW: vvl4F: goto B7hiY; u_EqT: if (empty($id)) { goto L_HAV; } goto yuHJx; eJKyY: $commission = unserialize($item['commission']); goto EfMsK; xr6Q9: UD5jf: goto f4OlW; a5X4P: case 'del': goto ChOMm; enhxv: $item = get('select * from ' . tb('level') . " where id = '{$id}'"); goto zpjXE; EVQoz: if (del('level', array("id" => $id)) === false) { goto mZCno; } goto u25u7; ChOMm: $id = $_GPC['id']; goto enhxv; jBEKU: goto g_3_S; goto ov0BL; C7DDY: goto mLX8c; goto UUzZM; u25u7: message('操作成功', $this->createWebUrl('level'), 'success'); goto C7DDY; UUzZM: mZCno: goto pgD1g; XIbOX: message('操作失败', $this->createWebUrl('level'), 'error'); goto gnd7w; pgD1g: message('操作失败', referer(), 'error'); goto uozKd; uozKd: mLX8c: goto jBEKU; zpjXE: if (!empty($item)) { goto VSoBQ; } goto XIbOX; gnd7w: VSoBQ: goto EVQoz; ov0BL: } goto OsXf4; Hg2p4: global $_W, $_GPC; goto ena8F; ena8F: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto lRGeg; P0Tz0: g_3_S: goto W3uV_; u0d3i: } public function doWebLorder() { goto bQhgO; PiV1G: nk1VP: goto UCYre; bQhgO: global $_W, $_GPC; goto svehv; svehv: $op = empty($_GPC['op']) ? 'display' : $_GPC['op']; goto lit0z; LMglv: pdo_query('delete from ' . tablename($this->modulename . '_lorder') . " where status = 0 and createtime < '{$t}' "); goto x3nef; UCYre: include $this->template('lorder'); goto tVwBL; i3Ypn: $t = time() - 60 * 60; goto LMglv; lit0z: $weid = $_W['uniacid']; goto i3Ypn; rw63y: r70QI: goto PiV1G; x3nef: switch ($op) { case 'display': goto qnecv; zM19b: goto nk1VP; goto y0h_8; xMXsB: set_time_limit(0); goto nGn9a; JNpaL: $condition .= ' and ( lid in (select id from ' . tb('level') . " where title like '%{$_GPC['g_kwd']}%' and weid = '{$weid}') )"; goto s2waQ; d8NCk: if (empty($_GPC['m_kwd'])) { goto iPrPF; } goto Cf5hW; tSjwb: $mids = array_unique($mids); goto ml9MZ; mdq7f: $condition = ''; goto eDENY; Cf5hW: $condition .= ' and ( mid in (select id from ' . tb('mem') . " where (nickname like '%{$_GPC['m_kwd']}%') and weid = '{$weid}') )"; goto lPxUQ; z7x0i: $excel_title[] = '订单编号'; goto iKYUO; dnfpC: $excel_title = array(); goto z7x0i; iKYUO: $excel_title[] = '等级名称'; goto bnleW; FneeT: $limit = 'limit ' . ($pindex - 1) * $psize . ',' . $psize; goto MK4R9; bnleW: $excel_title[] = '会员名称'; goto JFRO4; K5KrK: $exceler = new Jason_Excel_Export(); goto VzMTy; jv_NX: $end = $_GPC['dateline'] ? strtotime($_GPC['dateline']['end']) : time(); goto x5L0m; vFnHm: $exceler->setFileName($filename); goto dnfpC; x5L0m: if (empty($_GPC['dateline'])) { goto A1ecO; } goto mi7jZ; XSTMt: $exceler->setTitle($excel_title); goto bt89p; H3wTv: MA35r: goto iKpTy; NfSfC: if (empty($list)) { goto MA35r; } goto jUTpa; PemI0: $exceler->setContent($excel_data); goto cFgps; tK81o: $condition .= " and orderno like '%{$_GPC['keyword']}%' "; goto NvWy5; JRO2O: $levels = getall('select id,title,logo from ' . tb('level') . ' where id in (' . implode(',', $lids) . ')', 'id'); goto rkk9O; xkHwj: $money = pdo_fetchcolumn('select sum(price) from ' . tablename($this->modulename . '_lorder') . " where weid = '{$weid}' {$condition}"); goto PG6UC; eDENY: if (empty($_GPC['keyword'])) { goto dbVAh; } goto tK81o; JvSmj: $daymoney = col('select sum(price) from ' . tb('lorder') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status >= 1"); goto SNe8b; cttAX: OXY4Q: goto DRgnD; NghxL: LsBrZ: goto tSjwb; dyAVC: $uns = 0; goto UYLeD; cFgps: $exceler->export(); goto z5xrS; z5xrS: exit; goto qHwi3; VzMTy: $exceler->charset('UTF-8'); goto vFnHm; jUTpa: foreach ($list as $value) { goto J9kRg; blLLi: $lids[] = $value['lid']; goto lv3Hr; J9kRg: $mids[] = $value['mid']; goto blLLi; lv3Hr: aIPsC: goto R0sCK; R0sCK: } goto NghxL; XwNKv: $excel_data[] = array("总记录数:", $allsum); goto PemI0; EKIOQ: $list = pdo_fetchall('select * from ' . tablename($this->modulename . '_lorder') . " where weid = '{$weid}' {$condition} order by id desc {$limit}"); goto NfSfC; DRgnD: $start = $_GPC['dateline'] ? strtotime($_GPC['dateline']['start']) : time() - 30 * 24 * 3600; goto jv_NX; qvbPz: if (empty($_GPC['g_kwd'])) { goto pGdmG; } goto JNpaL; lPxUQ: iPrPF: goto qvbPz; lNxY7: $filename = '等级订单信息_' . date('YmdHis') . '.csv'; goto K5KrK; ml9MZ: $mems = getall('select id,nickname,avatar from ' . tb('mem') . ' where id in (' . implode(',', $mids) . ')', 'id'); goto AWLAI; mi7jZ: $condition .= " and createtime >= '{$start}' and  createtime <= '{$end}'"; goto vdHd9; iKpTy: $total = pdo_fetchcolumn('select count(1) from ' . tablename($this->modulename . '_lorder') . " where weid = '{$weid}' {$condition}"); goto xkHwj; xesNA: $psize = 20; goto mdq7f; MK4R9: if (!$_GPC['export']) { goto ez5tj; } goto jT3Ll; s2Lug: ez5tj: goto EKIOQ; qnecv: $pindex = max(intval($_GPC['page']), 1); goto xesNA; jK56v: $condition .= "and status = '{$_GPC['status']}'"; goto cttAX; AWLAI: $lids = array_unique($lids); goto JRO2O; PG6UC: $today = col('select count(1) from ' . tb('lorder') . " where weid='{$_W['uniacid']}' and to_days(from_unixtime(createtime)) = to_days(now()) and status >= 1"); goto JvSmj; UYLeD: foreach ($list as $val) { goto wYt1X; a2thQ: $allsum++; goto C3eKv; nFFIn: $status = '已支付'; goto tNhpF; bRcbB: goto HvTlF; goto So4M9; wYt1X: $status = ''; goto jIZwL; T8Utn: $data[] = $levels[$val['lid']]['title']; goto OoSlN; Ifaf7: $data[] = $val['orderno']; goto T8Utn; ZoYx_: $data[] = date('Y-m-d H:i:s', $val['createtime']); goto hnvs4; tNhpF: HvTlF: goto CWFUg; hnvs4: $excel_data[] = $data; goto a2thQ; nODJq: $data[] = $val['price']; goto ih3mP; CWFUg: $data = array(); goto Ifaf7; u3Vs2: $data[] = $status; goto ZoYx_; So4M9: FlsKt: goto nFFIn; ih3mP: $data[] = $val['transid']; goto u3Vs2; OoSlN: $data[] = $mems[$val['mid']]['nickname']; goto nODJq; EVMEg: $status = '待支付'; goto bRcbB; jIZwL: if ($val['status'] == 1) { goto FlsKt; } goto EVMEg; C3eKv: chgj9: goto PGOo4; PGOo4: } goto dwzuE; k2DgD: $excel_title[] = '流水id'; goto uoGdr; v_zov: $all = 0; goto dyAVC; rkk9O: if (!$_GPC['export']) { goto iKJwT; } goto xMXsB; vdHd9: A1ecO: goto FneeT; NvWy5: dbVAh: goto d8NCk; uoGdr: $excel_title[] = '状态'; goto W5vjf; NkUM2: if (!($_GPC['status'] != '')) { goto OXY4Q; } goto jK56v; W5vjf: $excel_title[] = '时间'; goto XSTMt; SNe8b: $pager = pagination($total, $pindex, $psize); goto zM19b; nGn9a: include_once IA_ROOT . '/addons/junsion_shopreback/excel.php'; goto lNxY7; qHwi3: iKJwT: goto H3wTv; dwzuE: uec0C: goto XwNKv; JFRO4: $excel_title[] = '订单金额'; goto k2DgD; jT3Ll: $limit = ''; goto s2Lug; s2waQ: pGdmG: goto NkUM2; bt89p: $allsum = 0; goto v_zov; y0h_8: case 'del': goto tLI_O; C9gqX: goto nk1VP; goto sl9rQ; efgIK: dgZk0: goto C9gqX; oEpAX: message('操作失败', $this->createWebUrl('lorder'), 'error'); goto nFP8a; NcsiY: message('操作成功', $this->createWebUrl('lorder'), 'success'); goto ER1lD; xtZdx: $item = pdo_fetch('select * from ' . tablename($this->modulename . '_lorder') . " where id = '{$id}'"); goto jNJIo; nFP8a: xNLGc: goto GfYZC; GfYZC: if (pdo_delete($this->modulename . '_lorder', array("id" => $id)) === false) { goto qLwxd; } goto NcsiY; CYn3Y: message('操作失败', referer(), 'error'); goto efgIK; gfBI_: qLwxd: goto CYn3Y; ER1lD: goto dgZk0; goto gfBI_; jNJIo: if (!empty($item)) { goto xNLGc; } goto oEpAX; tLI_O: $id = $_GPC['id']; goto xtZdx; sl9rQ: } goto rw63y; tVwBL: } public function sendRedPacket($params) { goto t0naU; Cg4cT: $return['code'] = -2; goto ma1Lf; PypD9: $uniacid = $_W['uniacid']; goto g0Ss5; Xmkr3: $pars['mch_appid'] = trim($_W['uniaccount']['key']); goto yqcN2; mzg76: $extras['CURLOPT_SSLKEY'] = OD_ROOT . md5("apiclient_{$uniacid}key") . '.pem'; goto CpwC8; x1VkL: goto zZZlR; goto pEjSq; D_qBj: $pars['openid'] = $openid; goto h4SAQ; pt70g: goto b70Dk; goto nCIUT; CnLhD: $code = $xpath->evaluate('string(//xml/err_code)'); goto Dtfh1; CnKCu: b70Dk: goto GrkVv; SZurR: return array("code" => 1, "msg" => $send_listid); goto eUa6q; srMfD: I_RIl: goto VTSVp; g_RdB: $resp = ihttp_request($url, $xml, $extras); goto v1bY4; U3RQV: v1aCD: goto VLXXM; VTSVp: $extras['CURLOPT_SSLCERT'] = OD_ROOT . md5("apiclient_{$uniacid}cert1") . '.pem'; goto bilIg; KhAMy: $pars['nonce_str'] = random(32); goto xXfQ0; h_KJ_: $money = floatval($params['price']); goto fPiS_; yqcN2: $pars['mchid'] = trim($cfg['mchid']); goto KhAMy; pg7bX: $cfg['APPKEY'] = $cfg['APPKEY1']; goto U3RQV; lT6UQ: if (strtoupper($code) == 'V2_ACCOUNT_SIMPLE_BAN') { goto Eqr6N; } goto pt70g; ma1Lf: goto b70Dk; goto Wuqdo; XpkAk: uwVi7: goto RVu1Q; t0naU: global $_W; goto PypD9; ENFvH: OPOnZ: goto g_RdB; wY50L: foreach ($pars as $k => $v) { $string1 .= "{$k}={$v}&"; o8B52: } goto tmwv0; DNJlh: $xml = array2xml($pars); goto mRTdA; CfgBC: ksort($pars, SORT_STRING); goto nj1Jy; h4SAQ: $pars['check_name'] = 'NO_CHECK'; goto YoAe4; jS1qg: goto yCXuO; goto XpkAk; vwP2v: if ($_W['account']['level'] == 4) { goto I_RIl; } goto S7zFG; kuXj2: c8ff9: goto pfgu3; fPiS_: load()->func('communication'); goto QcJGp; V9WYd: return array("code" => -1, "msg" => "error response"); goto x1VkL; pEjSq: d81y8: goto G34w7; VLXXM: $pars = array(); goto tZayy; nj1Jy: $string1 = ''; goto wY50L; Nnw2V: $pars['desc'] = $cfg['title'] . '余额提现'; goto CfgBC; Dtfh1: if (strtoupper($code) == 'OPENID_ERROR') { goto ycio4; } goto lT6UQ; kdj3R: file_put_contents(IA_ROOT . '/addons/junsion_shopreback/withfail', '
' . $procResult . '
' . json_encode($pars), FILE_APPEND); goto fAM27; GrkVv: return $return; goto LkUEP; YoAe4: $pars['amount'] = intval($money * 100); goto Nnw2V; z13Yr: $ret = $xpath->evaluate('string(//xml/result_code)'); goto VQi3_; EbMIk: $send_listid = $xpath->evaluate('string(//xml/payment_no)'); goto kOmYc; eUa6q: lybp4: goto IyKIP; Sal5n: $pars['sign'] = strtoupper(md5($string1)); goto DNJlh; Uu8ya: $pars['spbill_create_ip'] = trim($cfg['ip']); goto Xmkr3; rGsi6: $xml = '<?xml version="1.0" encoding="utf-8"?>' . $resp['content']; goto RE3W0; RE3W0: $dom = new DOMDocument(); goto pE4Us; os130: $string1 .= "key={$cfg['APPKEY']}"; goto Sal5n; jHSrt: yCXuO: goto mT2V_; fAM27: $procResult = $xpath->evaluate('string(//xml/err_code_des)'); goto Wk8qp; X11rI: if (!($_W['account']['level'] == 4)) { goto v1aCD; } goto wQ8r1; U_WCO: $cfg['mchid'] = $cfg['mchid1']; goto pg7bX; S7zFG: $extras['CURLOPT_SSLCERT'] = OD_ROOT . md5("apiclient_{$uniacid}cert") . '.pem'; goto mzg76; pf_vW: $uniacid = $params['uniacid']; goto kuXj2; Wuqdo: Eqr6N: goto pjEH8; pjEH8: $return['code'] = -3; goto CnKCu; g0Ss5: if (!$params['uniacid']) { goto c8ff9; } goto pf_vW; oacuM: FXBm6: goto SZurR; tmwv0: iDO59: goto os130; tZayy: $url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/promotion/transfers'; goto Uu8ya; pfgu3: $openid = $params['openid']; goto h_KJ_; QcJGp: $cfg = $params['cfg'] ? $params['cfg'] : $this->module['config']; goto X11rI; CpwC8: goto OPOnZ; goto srMfD; VQi3_: if (strtolower($code) == 'success' && strtolower($ret) == 'success') { goto FXBm6; } goto kdj3R; Wk8qp: $return = array("code" => -1, "msg" => $procResult); goto CnLhD; nCIUT: ycio4: goto Cg4cT; kOmYc: $code = $xpath->evaluate('string(//xml/return_code)'); goto z13Yr; xXfQ0: $pars['partner_trade_no'] = random(28); goto D_qBj; wQ8r1: $cfg['ip'] = $cfg['ip1']; goto U_WCO; LkUEP: goto lybp4; goto oacuM; IyKIP: zZZlR: goto jS1qg; v1bY4: if (is_error($resp)) { goto uwVi7; } goto rGsi6; pE4Us: if ($dom->loadXML($xml)) { goto d81y8; } goto V9WYd; bilIg: $extras['CURLOPT_SSLKEY'] = OD_ROOT . md5("apiclient_{$uniacid}key1") . '.pem'; goto ENFvH; mRTdA: $extras = array(); goto vwP2v; G34w7: $xpath = new DOMXPath($dom); goto EbMIk; RVu1Q: return array("code" => -1, "msg" => $resp['message']); goto jHSrt; mT2V_: } public function getParamsQr($mid, $wid) { goto jqg5V; VIVVM: $barcode['action_name'] = 'QR_STR_SCENE'; goto FmhEl; rN7kt: OjvwU: goto ibeN_; Z008i: $rule['content'] = $names; goto nQl0s; pTICg: goto h6HpZ; goto rN7kt; bLNRT: pdo_delete('qrcode', array("id" => $is_save['id'])); goto khhTg; rMd_P: $is_save = pdo_fetch('select * from ' . tablename('qrcode') . " where name='{$names}' and uniacid='{$wid}'"); goto zYrda; B2uVc: if (empty($r)) { goto OjvwU; } goto phnIs; NC9uW: $rule['type'] = 1; goto uFkUP; Ea54O: $uniacccount = WeAccount::create($acid); goto y3Nvh; ddPfS: $m = $this->modulename; goto Ixmhx; nQl0s: pdo_insert('rule_keyword', $rule); goto JLfg7; mhY91: $barcode['action_info']['scene']['scene_str'] = $names; goto aKj_J; y3Nvh: $barcode['expire_seconds'] = 30 * 86400; goto VIVVM; F1l8O: unset($rule['name']); goto NC9uW; phnIs: $rid = $r['id']; goto pTICg; SJqmY: if (!empty($res['ticket'])) { goto myY4S; } goto wVqJj; E1URj: if (!empty($rk)) { goto qO7X8; } goto F1l8O; ibeN_: pdo_insert('rule', $rule); goto BjM35; khhTg: $is_save = array(); goto kJVx1; Nv2tq: $rule = array("uniacid" => $wid, "name" => $m, "module" => $this->modulename, "status" => 1, "displayorder" => 250); goto B2uVc; uFkUP: $rule['rid'] = $rid; goto Z008i; FmhEl: $barcode['action_info']['scene']['scene_id'] = '1'; goto mhY91; CkU_L: return $is_save['url']; goto EmROm; PhjDK: $acid = pdo_fetchcolumn('select acid from ' . tablename('account') . " where uniacid={$wid}"); goto Ea54O; hS1SE: myY4S: goto qfZOF; JLfg7: qO7X8: goto MNT9q; NWH_O: $names = $this->modulename . $weid . ':' . $mid . ':app'; goto rMd_P; wVqJj: return '生成二维码失败：' . implode(',', $res); goto hS1SE; kJVx1: SL69c: goto tEJ0U; aKj_J: $res = $uniacccount->barCodeCreateDisposable($barcode); goto SJqmY; D1S5Y: load()->model('account'); goto PhjDK; MNT9q: return $res['url']; goto q5rTS; He9N4: xR5GB: goto D1S5Y; qfZOF: pdo_insert('qrcode', array("uniacid" => $wid, "acid" => $acid, "name" => $names, "keyword" => $names, "model" => 1, "ticket" => $res['ticket'], "scene_str" => $names, "expire" => 30 * 86400, "createtime" => time(), "status" => 1, "url" => $res['url'])); goto ddPfS; hEf1j: $weid = $_W['uniacid']; goto NWH_O; EmROm: exit; goto He9N4; jqg5V: global $_W, $_GPC; goto hEf1j; BjM35: $rid = pdo_insertid(); goto mAfhp; tEJ0U: if (empty($is_save)) { goto xR5GB; } goto CkU_L; Ixmhx: $r = pdo_fetch('select id from ' . tablename('rule') . " where module='{$m}' and name='{$m}'"); goto Nv2tq; eJJIg: $rk = pdo_fetch('select id from ' . tablename('rule_keyword') . " where content='{$names}' and rid='{$rid}'"); goto E1URj; zYrda: if (!(!empty($is_save) && $is_save['createtime'] + 30 * 60 * 60 * 24 < time())) { goto SL69c; } goto bLNRT; mAfhp: h6HpZ: goto eJJIg; q5rTS: } function trimPx($data) { goto JLxVY; bQXoB: return $data; goto erd0A; JLxVY: $data['left'] = intval(str_replace('px', '', $data['left'])) * 2; goto snwGm; snwGm: $data['top'] = intval(str_replace('px', '', $data['top'])) * 2; goto QFtKn; rWdA8: $data['src'] = tomedia($data['src']); goto bQXoB; OAdFM: $data['height'] = intval(str_replace('px', '', $data['height'])) * 2; goto uILRf; uILRf: $data['size'] = intval(str_replace('px', '', $data['size'])) * 2; goto rWdA8; QFtKn: $data['width'] = intval(str_replace('px', '', $data['width'])) * 2; goto OAdFM; erd0A: } function imagecreates($bg) { goto s0HpS; LpZ47: VXs52: goto sWIMH; Avaql: return $bgImg; goto ir4tI; sWIMH: if (!(FALSE == $bgImg)) { goto Q7O7x; } goto j3ctN; TOnXZ: $bgImg = @imagecreatefromjpeg($bg); goto LpZ47; WFyLn: Q7O7x: goto Avaql; j3ctN: $bgImg = @imagecreatefromgif($bg); goto WFyLn; s0HpS: $bgImg = @imagecreatefrompng($bg); goto JR2ZU; JR2ZU: if (!(FALSE == $bgImg)) { goto VXs52; } goto TOnXZ; ir4tI: } function mergeText($target, $text, $data) { goto gcOd3; RBy9H: $color = imagecolorallocate($target, $colors['red'], $colors['green'], $colors['blue']); goto HFPPz; gcOd3: $font = IA_ROOT . '/web/resource/fonts/msyhbd.ttf'; goto DwU9Z; Er60d: return $target; goto pyvnD; HFPPz: imagettftext($target, $data['size'], 0, $data['left'], $data['top'] + $data['size'], $color, $font, $text); goto Er60d; DwU9Z: $colors = $this->hex2rgb($data['color']); goto RBy9H; pyvnD: } function hex2rgb($colour) { goto MXgPA; irw21: list($r, $g, $b) = array($colour[0] . $colour[1], $colour[2] . $colour[3], $colour[4] . $colour[5]); goto jSF4_; jSF4_: goto XJ57V; goto Ogl8p; T9RjF: $colour = substr($colour, 1); goto cgJav; wYw9r: goto XJ57V; goto K8JZX; iNli2: $g = hexdec($g); goto pg20E; MXgPA: if (!($colour[0] == '#')) { goto DD46k; } goto T9RjF; pg20E: $b = hexdec($b); goto U6R7M; DOsoB: if (strlen($colour) == 6) { goto qDv0A; } goto WSy02; K8JZX: qDv0A: goto irw21; GPyau: return false; goto wYw9r; LOH_z: XJ57V: goto PVe6O; PVe6O: $r = hexdec($r); goto iNli2; Ogl8p: uLnxD: goto xMsNd; U6R7M: return array("red" => $r, "green" => $g, "blue" => $b); goto AOp1J; xMsNd: list($r, $g, $b) = array($colour[0] . $colour[0], $colour[1] . $colour[1], $colour[2] . $colour[2]); goto LOH_z; WSy02: if (strlen($colour) == 3) { goto uLnxD; } goto GPyau; cgJav: DD46k: goto DOsoB; AOp1J: } function saveImage($url, $tag = "") { goto iIgVZ; hYzv3: $return_code = curl_getinfo($ch, CURLINFO_HTTP_CODE); goto Be1XB; C8Xqp: ob_start(); goto fLnKd; EmPvO: curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); goto MFzSW; rX_m1: ob_end_clean(); goto hYzv3; MFzSW: curl_setopt($ch, CURLOPT_URL, $url); goto C8Xqp; Ld_PH: return $filename; goto sTrze; jxuTV: $fp = @fopen($filename, 'a'); goto c1JdO; iIgVZ: $ch = curl_init(); goto rTB8W; Be1XB: $filename = IA_ROOT . "/addons/junsion_winaward/qrcode/temp{$tag}.jpg"; goto jxuTV; rTB8W: curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'GET'); goto EmPvO; qVHeG: $return_content = ob_get_contents(); goto rX_m1; c1JdO: fwrite($fp, $return_content); goto Ld_PH; fLnKd: curl_exec($ch); goto qVHeG; sTrze: } function mergeImage($target, $imgurl, $data) { goto KTEPi; oDGrU: return $target; goto wEU8F; mQNdw: $h = imagesy($img); goto qeDKv; E2O1z: imagedestroy($img); goto oDGrU; KTEPi: $img = $this->imagecreates($imgurl); goto XGcI1; qeDKv: imagecopyresized($target, $img, $data['left'], $data['top'], 0, 0, $data['width'], $data['height'], $w, $h); goto E2O1z; XGcI1: $w = imagesx($img); goto mQNdw; wEU8F: } public function createLinkQr($mid, $url) { goto tB0hS; EFv5_: $matrixPointSize = '4'; goto xMbtg; tB0hS: global $_W; goto h2nYD; h2nYD: include_once IA_ROOT . '/addons/' . $this->modulename . '/phpqrcode.php'; goto freB8; xMbtg: QRcode::png($url, $q, $errorCorrectionLevel, $matrixPointSize); goto wYQjl; IUA5C: $errorCorrectionLevel = 'L'; goto EFv5_; IF9Ke: $q = $path . 'weid' . $mid . '.png'; goto RBzCf; scXzq: mkdir($path, 0777); goto qzB2_; zQOge: n2pmD: goto IUA5C; freB8: $path = '../addons/' . $this->modulename . '/qrcode/'; goto BZ_RW; BZ_RW: if (file_exists($path)) { goto ZSmS3; } goto scXzq; x3mMM: return $q; goto zQOge; wYQjl: return $q; goto EseHF; qzB2_: ZSmS3: goto IF9Ke; RBzCf: if (!file_exists($q)) { goto n2pmD; } goto x3mMM; EseHF: } } ?>